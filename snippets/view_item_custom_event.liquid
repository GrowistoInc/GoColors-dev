<script>
(function () {

  let fired = false;

  function fireViewItemList() {

    if (fired) return;

    // ⬇️ CHANGE THIS SELECTOR IF NEEDED
    const cards = document.querySelectorAll('[data-product-id]');
    if (!cards.length) return;

    fired = true;

    const items = [];

    cards.forEach((card, index) => {

      const productId = card.getAttribute('data-product-id');
      const productName =
        card.getAttribute('data-product-title') ||
        card.querySelector('a')?.innerText?.trim() ||
        'NA';

      const price =
        parseFloat(
          card.getAttribute('data-price') ||
          card.querySelector('[class*="price"]')?.innerText.replace(/[^0-9.]/g, '')
        ) || 0;

      items.push({
        item_id: productId,
        item_name: productName,
        affiliation: "Online Store",
        coupon: "",
        discount: 0,
        index: index + 1,
        item_brand: "Powerlook",
        item_category: card.getAttribute('data-collection') || "NA",
        item_category2: "NA",
        item_category3: "NA",
        item_category4: "NA",
        item_category5: "Men",
        item_list_id: "all_products",
        item_list_name: "All Products",
        item_variant: "",
        location_id: "online_store",
        price: price,
        quantity: 1
      });
    });

    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
      event: "view_item_list",
      currency: "INR",
      items: items
    });

    console.log("✅ GA4 view_item_list fired", items);
  }

  // Watch DOM for product cards
  const observer = new MutationObserver(fireViewItemList);
  observer.observe(document.body, { childList: true, subtree: true });

  // Fallback
  window.addEventListener('load', fireViewItemList);

})();
</script>
