{% if product %}
<script>
document.addEventListener("DOMContentLoaded", function () {

     const collectionsArr = window.collectionsName.value.split(',').map(item => item.trim());
          const itemCategories = {};

          collectionsArr.forEach((value, index) => {
            itemCategories[`item_category${index + 1}`] = value;
          });

  window.dataLayer = window.dataLayer || [];

  dataLayer.push({
    event: "view_item",
    ecommerce: {
      currency: "{{ cart.currency.iso_code | default: shop.currency }}",
      value: {{ product.selected_or_first_available_variant.price | divided_by: 100.0 }},
      items: [{
        item_id: "{{ product.id }}",
        item_name: "{{ product.title | escape }}",
        affiliation: "{{ shop.name | escape }}",
        coupon: "",
        discount: 0,
        index: 0,
        item_brand: "{{ product.vendor | escape }}",
       ...itemCategories,
        item_list_id: "product_page",
        item_list_name: "Product Detail Page",
        item_variant: "{{ product.selected_or_first_available_variant.title | escape }}",
        location_id: "{{ product.handle }}",
        price: {{ product.selected_or_first_available_variant.price | divided_by: 100.0 }},
        quantity: 1
      }]
    }
  });

  console.log("âœ… view_item pushed to dataLayer", window.dataLayer);

});
</script>
{% endif %}
