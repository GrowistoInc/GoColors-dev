<script>
(function () {

  function sendViewItemListGA4() {

    const productCards = document.querySelectorAll('.product-card-wrappe');
    if (!productCards.length) return;

    const items = [];

    productCards.forEach((card, index) => {

      const titleEl = card.querySelector('.similar-product-title a');
      const priceEl =
        card.querySelector('.f-price-item--sale') ||
        card.querySelector('.price-item--regular');

      const productName = titleEl?.innerText?.trim() || 'NA';

      // Try to get variant / product info from data attributes if available
      const productId =
        card.getAttribute('data-variant-id') ||
        card.getAttribute('data-product-id') ||
        `product_${index + 1}`;

      const itemVariant =
        card.getAttribute('data-variant-title') || '';

      const itemCategory =
        card.getAttribute('data-collection-title') || 'NA';

      const itemCategory2 =
        card.getAttribute('data-collection-id') || 'NA';

      const itemSize =
        card.getAttribute('data-size') || 'NA';

      const price =
        parseFloat(priceEl?.innerText.replace(/[^0-9.]/g, '')) || 0;

      items.push({
        item_id: productId.toString(),
        item_name: productName,
        affiliation: "Online Store",
        coupon: "",
        discount: 0,
        index: index + 1,
        item_brand: "Powerlook",
        item_category: itemCategory,
        item_category2: itemCategory2,
        item_category3: "NA",
        item_category4: itemSize,
        item_category5: "Men",
        item_list_id: "all_products",
        item_list_name: "All Products",
        item_variant: itemVariant,
        location_id: "online_store",
        price: price,
        quantity: 1
      });
    });

    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
      event: "view_item_list",
      currency: "INR",
      items: items,
      page_type: "{{ template | handleize }}",
      userID: "{{ customer.id }}",
      user_type: "{{ customer.tags | join: ',' | default: 'guest' }}"
    });

    console.log("âœ… GA4 view_item_list pushed to dataLayer", items);
  }

  // Delay ensures products are rendered (important for Shopify)
  window.addEventListener('load', function () {
    setTimeout(sendViewItemListGA4, 1500);
  });

})();
</script>
