{% if product %}
<script>
document.addEventListener("DOMContentLoaded", function () {

  const storedItem = sessionStorage.getItem('ga4_view_item');
  if (!storedItem) return;

  const item = JSON.parse(storedItem);

  item.item_id = "{{ product.id }}";
  item.item_name = "{{ product.title | escape }}";
  item.item_variant = "{{ product.selected_or_first_available_variant.title | escape }}";
  item.price = {{ product.selected_or_first_available_variant.price | divided_by: 100.0 }};
  item.location_id = window.location.href;

  window.dataLayer = window.dataLayer || [];
  dataLayer.push({
    event: "view_item",
    ecommerce: {
      currency: "{{ cart.currency.iso_code | default: shop.currency }}",
      value: item.price,
      items: [item]
    }
  });

  console.log("âœ… view_item pushed", item);

  // Cleanup
  sessionStorage.removeItem('ga4_view_item');

});
</script>
{% endif %}
