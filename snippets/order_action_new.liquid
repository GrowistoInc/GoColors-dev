<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<style>
  .order_loader {
    border: 5px solid #f3f3f3;
    border-radius: 50%;
    border-top: 5px solid #5e52ec;
    width: 35px;
    height: 35px;
    -webkit-animation: spin 2s linear infinite;
    animation: spin 2s linear infinite;
    margin-top: 10px;
  }
   div#return_line_modal {
        z-index: 9999;
    }
   select.cancel_reasons {
    margin: 2rem 0 0;padding:15px;
    border-radius: 5px;    font-size: 16px;
    }
    textarea#other_cancel_reason {
        border: 1px solid grey;
        margin: 1rem 0 0;
        border-radius: 5px;
    }
    textarea#other_cancel_reason::placeholder {
        color: #8f8f8f;
        font-size: 12px;
    }
   
  /* Safari */
  @-webkit-keyframes spin {
    0% {
      -webkit-transform: rotate(0deg);
    }
    100% {
      -webkit-transform: rotate(360deg);
    }
  
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
  #cancel_line_modal .modal-content {
    align-items: center;
        padding-bottom: 41px;
  }
  #cancel_line_modal .modal-footer button {
    line-height: 1;
  }
  #cancel_line_modal .modal-footer button,
  #cancel_line_modal .cancel_qty {
    border-radius: 5px !important;
  }
  #cancel_line_modal .close {
    border: none !important;
  }
  #cancel_line_modal .modal-body {
    display: flex;
    flex-direction: column;
  }
  #cancel_line_modal .modal-body label {
    margin-bottom: 10px;
    font-size: 12px;
    text-transform: uppercase;
  }
  .cancel_order_line_item{
    padding: 8px 30px;
    background-color: #000;
    color: #fff;
    border-color: #000;
    transition: .4s ease-out;
  }
  .cancel_order_line_item:hover{
   background-color: #fff;
    color: #000;
    border-color: #000;
  }

  .modal-footer .no-btn{
     padding: 8px 30px;
    background-color: #000;
    color: #fff;
}
  
  .modal-body p{
        font-size: 14px;
    margin: 0;
}
  #cancel_line_modal .modal-header {
   width:100%;
  }
  #cancel_line_modal .modal-title {
    text-align: left;
    font-size: 15px;
    color: #1a1a1a;
  }
  button.modalbtn {
    padding: 5px 15px !important;
    border-radius: 5px !important;
    background-color: #000;
    color: #fff;
    transition: .4s ease-out;
    font-size: 12px !important;
}
  button.modalbtn:hover{
    background-color: #fff;
    color: #000;
  }
  #cancel_line_modal .modal-footer,
  #cancel_line_modal .modal-body {
    width: 100%
  }
  input#cust_acc_name, input#acc_no, input#ifsc_code {
    width: auto;
    height: 40px;
    border-radius: 5px;
}
.text-danger,
.text-success {
display: block;
}

 table.zsFormClass tr{
   display:flex;
   /* align-items:baseline; */
   align-items:center;
       padding: 10px 5px;
   gap:10px;
 }
    table.zsFormClass tr td:first-child {
      font-size: 14px;
       flex: 40%;
    }
   table.zsFormClass tr td:last-child{
    flex:60%;
   }
  table.zsFormClass tr td:last-child input,
   table.zsFormClass tr td:last-child select{
    width: 100% !important;
     border-radius: 5px;
  }
  table.zsFormClass tr:last-child td:last-child {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}
 select#return_qty {
    padding: 10px 20px 10px 9px;
}
  #return_line_modal .modal-body {
  padding: 0;
}
#return_line_modal #return_qty {
  font-family: var(--font-body-family);
  font-style: var(--font-body-style);
  font-weight: var(--font-body-weight);
  font-size: 1.2rem;
  color: rgba(var(--color-foreground), 0.75);
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path d="M7 10l5 5 5-5H7z" /></svg>');
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 16px;
  padding-right: 30px;
  border-radius: 4px;
  height: 35px;
  width: 100%;
  line-height: normal;
}
select.cancel_reasons:focus option:first-child {
    display: none;
}
@media screen and (max-width: 820px){
  .navslider ul li::before{
    top: -3px!important
  }
}
.modal-dialog.order-table .modal-content input {
  width: 350px;
}
  .modal-dialog.order-table input, 
  .modal-dialog.order-table textarea {
    font-size: 14px;
    line-height: 20px;
    padding: 15px 20px;
    border: 1px solid #707070;
    border-radius: 15px;
    background-color: #fff;
  }
  .modal-dialog.order-table .btn, 
  .modal-dialog.order-table button, 
  .modal-dialog.order-table input, 
  .modal-dialog.order-table input[type=button], 
  .modal-dialog.order-table input[type=reset], 
  .modal-dialog.order-table input[type=submit], 
  .modal-dialog.order-table textarea {
    color: #3e3e3e;
    transition: .4s ease-out;
    box-sizing: border-box;
    margin: 0;
    font-family: 'DM Sans',sans-serif;
    direction: ltr;
    outline: 0;
  }
  .modal-dialog.order-table button:not(:disabled) {
    padding: 8px 30px;
    background-color: #000;
    color: #fff;
    border-color: #000000;
  }
  .modal-dialog.order-table .heading-tab, 
  .modal-dialog.order-table .order-table td, 
  .modal-dialog.order-table .order-table th, 
  .modal-dialog.order-table .order-table tr td:first-child, 
  .modal-dialog.order-table .order-table tr td:last-child, 
  .modal-dialog.order-table .order-table tr th:first-child, 
  .modal-dialog.order-table .order-table tr th:last-child {
    padding: 10px;
  }
  .modal-dialog.order-table button.btn.btn-primary.return_order_line_item, 
  .modal-dialog.order-table button.btn.btn-secondary {
    border-radius: 5px!important;
  }
  .modal-dialog.order-table select {
    border: 1px solid #707070;
  }
  .modal-dialog.order-table .modal-content{
    padding: 1rem !important;
  }
  .modal-dialog.order-table .modalbtn{
    font-size:22px;
    padding: 0px 20px !important;
  }
  .modal-dialog.order-table .select_return_reason {
    -webkit-appearance: none; 
    -moz-appearance: none;    
    appearance: none;   
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path d="M7 10l5 5 5-5H7z" /></svg>'); /* Custom arrow icon */
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 16px;
    padding-right: 30px; 
    border-radius: 4px;
    height: 35px; 
    width: 100%; 
  }
  
  .modal-dialog.order-table .select_return_reason:focus {
    outline: none;
  }
  
.custom-return-reasons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top:10px;
}
.modal-dialog.order-table .custom-return-reasons button {
  padding: 4px 16px;
  border: 1px solid #000;
  border-radius: 9999px;
  background: #fff!important;
  cursor: pointer;
  color: #000!important;
  font-size: 14px;
  transition: all 0.2s ease-in-out;
}
.modal-dialog.order-table .custom-return-reasons button.selected {
  background: #000!important;
  color: #fff!important;
}
 select#cancel_qty {
    font-size:16px;
  }
</style>
<div
  class="modal fade"
  id="cancel_line_modal"
  role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h6 class="modal-title modale_head"></h6>
        <input
          type="hidden"
          name="cancelled_qty"
          id="cancelled_qty">
        <input
          type="hidden"
          name="shopify_order_id"
          id="shopify_order_id">
        <input
          type="hidden"
          name="line_sku"
          id="line_sku">
        <input
          type="hidden"
          name="order_number"
          id="order_number">
        <input
          type="hidden"
          name="type"
          id="modal_type"
          value="cancel">
        <button
          class="modalbtn"
          type="button"
          class="close"
          class="btn-close"
          data-bs-dismiss="modal">&times;</button>
      </div>
      <!-- Modal body -->
      <div class="order_loader"></div>
      <div class="modal-body"></div>
      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-primary cancel_order_line_item">Yes</button>
        <button
          type="button"
          class="btn btn-secondary no-btn"
          data-bs-dismiss="modal">No</button>
      </div>
      <div class='return_ini'></div> 
    </div>
  </div>
</div>


<div
  class="modal fade"
  id="return_line_modal"
  role="dialog">
  <div class="modal-dialog order-table" {{ order.gateway }} {{order.tags }}>
    <div class="modal-content" >
      <!-- Modal Header -->
      <div class="modal-header">
        <h6 class="modal-title modale_head"></h6>
        <input
          type="hidden"
          name="type"
          id="modal_type"
          value="return">
        <input
          type="hidden"
          name="returned_qty"
          id="returned_qty"
          value="">
        <input
          type="hidden"
          name="return_shopify_order_id"
          id="return_shopify_order_id"
          value="">
        <button
          class="modalbtn"
          type="button"
          class="close"
          class="btn-close"
          data-bs-dismiss="modal">&times;</button>
      </div>
      <script>
        window.orderData = {
            gateway: "{{ customer.orders.last.transactions.last.gateway_display_name }}",
            tags: "{{ customer.orders.last.tags | join: ',' }}"
        };
        </script>
      <!-- Modal body -->
       {% if  order.gateway contains "Cash on Delivery (COD)" or order.tags contains 'COD' %} 
      <span style="text-align: center; padding:15px 0 0;">
        <b>NOTE :</b> Please Fill The Below Details Correctly !</span>
       {%- endif -%} 
      <table border='0'cellspacing='0'class='zsFormClass'>
         {% if  order.gateway contains "Cash on Delivery (COD)" or customer.orders.last.tags contains 'COD' %} 
                <tr>
                    <td > Account Holder Name :</td>
                    <td ><input type="text" maxlength="17" id="cust_acc_name" name="cust_acc_name" >
                    <span id="cust_acc_name_error" class="text-danger"></span></td>
                </tr>
                <tr>
                    <td >Enter Account Number :</td>
                    <td ><input type="text" maxlength="17" id="acc_no" name="acc_no">
                    <span id="acc_no_error" class="text-danger"></span></td>
                </tr>
                <tr>
                    <td>
                    Enter IFSC Code :
                    </td>
                    <td><input type="text" maxlength="11" minlength="11" id="ifsc_code" name="ifsc_code">
                    <span id="ifsc_code_error" class="text-danger"></span></td>
                </tr>
           {%- endif -%}   
        
            <input
              type='hidden'
              maxlength='30'
              name='name'
              id="name"
              class='' />
    
            <input
              type='hidden'
              maxlength='120'
              name='customer_email'
              readonly
              id="customer_email"
              value=''
              class='' />
            <input
              type='hidden'
              maxlength='15'
              name='order_number_return'
              readonly
              id="order_number_return"
              value=''
              class='' />
      
            <input
              type='hidden'
              maxlength='11'
              name='phone'
              id="phone"
              value='' />
         <input
              type='hidden'
              maxlength='11'
              name='item_final_awb'
              id="item_final_awb"
              value='' />
            <input
              type='hidden'
              maxlength='15'
              name='sku'
              readonly
              id="sku"
              value=''
              class='' />
            <span id="sku_error" class="text-danger"></span>
        
         <tr>
          <td 
            nowrap
            class='select_qty'
            width='25%'
            align='left'> Selected Quantity </td>          
          <td 
            align='left'
            width='25%'
            class="modal-body"></td>
        </tr>
        <tr>
          
          <td 
            align='left'
            width='25%'
            class="return_body">
                <span class="select_return_reason_heading">Reason for Cancellation:</span>
                <div class="custom-return-reasons" data-select-id="return_reason">
                  <input type="hidden" name="attributes[Order Return Reason]" id="return_reason">
                  <button type="button" data-value="Size is too large">Size is too large</button>
                  <button type="button" data-value="Size is too small">Size is too small</button>
                  <button type="button" data-value="Colour mismatch">Colour mismatch</button>
                  <button type="button" data-value="Item damaged on arrival">Item damaged on arrival</button>
                  <button type="button" data-value="Parcel damaged on arraival">Parcel damaged on arraival</button>
                  <button type="button" data-value="Missing item">Missing item</button>
                  <button type="button" data-value="Changed my mind">Changed my mind</button>
                  <button type="button" data-value="Item arrived too late">Item arrived too late</button>
                  <button type="button" data-value="Quality not as expected">Quality not as expected</button>
                  <button type="button" data-value="Others">Others</button>
                </div>
              <span id="return_reason_error" class="text-danger"></span>
            </td>
        </tr>
       <tr>
         <td>
           <textarea
            rows="10"
            id="other_reason"
            class="text-area field__input"
            name="attributes[Order Return Other Reason]"
            placeholder="Write a reason"
            style="display:none; max-width:100%;"
            onkeypress="$('#return_other_reason_error').text('');"></textarea>
           <span id="return_other_reason_error" class="text-danger"></span>
         </td>
       </tr>
        <tr>
          <td
            colspan='2'
            align='right'
            width='25%'>
            <button type="button" class="btn btn-primary return_order_line_item">Yes</button>
            <button
              type="button"
              class="btn btn-secondary no-btn"
              data-bs-dismiss="modal">No</button>
          </td>
        </tr>
      </table>
      <div class='return_ini'></div>
    </div>
  </div>
</div>

<!--end code-->
<script>
  document.querySelectorAll('.custom-return-reasons button').forEach(button => {
    button.addEventListener('click', function () {
      // Remove selected class from all
      document.querySelectorAll('.custom-return-reasons button').forEach(btn => btn.classList.remove('selected'));
      // Add selected class to clicked
      this.classList.add('selected');
      // Set hidden input value
      document.getElementById('return_reason').value = this.dataset.value
      const event = new Event('change', { bubbles: true });
      document.getElementById('return_reason').dispatchEvent(event);
    });
  });
</script>

<script>
  $(document).ready(function() {
    var customer_email = localStorage.getItem("customer_email");    
    var name = localStorage.getItem("name");
    $('.btn-cancel').on('click', function() {
      var productTitle = $(this).attr('data-title-name');
      var shopify_order_id = $(this).attr('data-order-id');
      var order_number = $(this).attr('data-order-number');
      var line_sku = $(this).attr('data-sku');
      var remaining_qty = $(this).attr('data-remaining_qty');
      var modal_id = $('#cancel_line_modal');
      var item_id = $(this).attr('data-item-id');
      var action_type = 'cancel';
      popUpDataShow(productTitle, shopify_order_id, line_sku, 'cancel', remaining_qty, modal_id, action_type, order_number,item_id);
    });
  // code by snehal on 7/10/22
    $('.btn-return').on('click', function() {
      var productTitle = $(this).attr('data-title-name');
      var shopify_order_id = $(this).attr('data-order-id');
      var order_number = $(this).attr('data-order-number');
      var line_sku = $(this).attr('data-sku');
      var remaining_qty = $(this).attr('data-remaining_qty');
      var modal_id = $('#return_line_modal');
       var item_id = $(this).attr('data-item-id');
      var action_type = 'return';
      popUpDataShow(productTitle, shopify_order_id, line_sku, 'return', remaining_qty, modal_id, action_type, order_number,item_id);
    });
   // end code
  });
  function popUpDataShow(productTitle, shopify_order_id, line_sku, type, remaining_qty, modal, action_type, order_number,item_id) {
    $('.order_loader').hide();
    $('#' + type + '_line_modal').addClass('show');
    $('#' + type + '_line_modal').css('display','block');
   // $('#' + type + '_line_modal').modal('show');
    var customer_email ="{{ customer.email}}";
    var customer_fname ="{{ customer.first_name}}";
    var customer_lname ="{{ customer.last_name}}";    
    var customer_name ="{{ customer.name}}";
    var phone ="{{ order.shipping_address.phone}}";    
    var name=customer_fname+" "+customer_lname;
    var final_awb=$('#final_awb_number_'+item_id).val();
    
    $.trim(name);
    if(name=="")
    {
       name=customer_name;
    }  
    {% comment %} var model_title = "Are you sure you want to " + type + " " + productTitle; {% endcomment %}
         var model_title = "Are you sure you want to " + type + " the order? " + " ";

    modal.find('.modal-title').text(model_title);

    $('.modalbtn').click(function(){
     $('#' + type + '_line_modal').removeClass('show');
     $('#' + type + '_line_modal').css('display','none');
      });  
    
    if (action_type == 'return') {   
      var order_gatway ="{{ order.gateway }}";
      {% assign order_tag = order.tags %}
      let order_tags = "{{ order_tag }}" ;
      $('.modalbtn').click(function(){       
        if(order_gatway=="Cash on Delivery (COD)" || order_tags.includes("COD")){
            $('#cust_acc_name').val('');
            $('#acc_no').val('');
            $('#ifsc_code').val('');
          }
      });   
      $("#customer_email").val(customer_email);
      $("#name").val(name);
      $("#phone").val(phone);
      $("#item_final_awb").val(final_awb);
      $('#order_number_return').val(order_number);
      $('#return_shopify_order_id').val(shopify_order_id);
      
      $('#sku').val(line_sku);

      var model_quantity_html = "";

      if (remaining_qty > 1) {
        model_quantity_html += '<select name="return_qty" class="return_qty" id="return_qty">' + '<option value="0">Select ' + type.charAt(0).toUpperCase() + type.slice(1) + ' quantity</option>';
        for (var i = 1; i <= remaining_qty; i++) {
          model_quantity_html += '<option value="' + i + '">' + i + '</option>';
        }

        model_quantity_html += '</select><span id="return_qty_error" class="text-danger"></span>';
        model_quantity_html += '</select><span id="return_qty_success" class= "text-success"></span>';
      } else {
        $('#returned_qty').val(remaining_qty);
        model_quantity_html += "<p>1</p>"
        model_quantity_html += '</select><span id="return_qty_success" class= "text-success"></span>';
      }
    }
    else {
      modal.find('#shopify_order_id').val(shopify_order_id);

      modal.find('#order_number').val(order_number);
      modal.find('#line_sku').val(line_sku);
      var model_quantity_html = "<label>Selected Quantity</label>";
      if (remaining_qty > 1) {
        model_quantity_html += '<select name="cancel_qty" class="cancel_qty" id="cancel_qty">' + '<option value="0">Select ' + type.charAt(0).toUpperCase() + type.slice(1) + ' quantity</option>';
        for (var i = 1; i <= remaining_qty; i++) {
          model_quantity_html += '<option value="' + i + '">' + i + '</option>';
        }
        model_quantity_html += '</select><span id="cancel_qty_error" class="text-danger"></span>';
        model_quantity_html +=  `<select name="cancel_reasons" class="cancel_reasons">
                                    <option value="select cancel reason"> Select Reason</option>
                                    <option value="Ordered by mistake" >Ordered by mistake</option>
                                    <option value="Placed duplicate order">Placed duplicate order</option>
                                    <option value="Selected wrong size">Selected wrong size</option>
                                    <option value="Changed my mind">Changed my mind</option>
                                    <option value="Found a better price elsewhere">Found a better price elsewhere</option>
                                    <option value="No longer needed">No longer needed</option>
                                    <option value="Want to reorder with different payment method">Want to reorder with different payment method</option>`;                    
        model_quantity_html += '</select><span id="cancel_reason_error" class="text-danger"></span><span id="cancel_qty_success" class= "text-success"></span>';

      } else {
        modal.find('#cancelled_qty').val(remaining_qty);
        model_quantity_html += "<p>1</p>"
          model_quantity_html +=  `<select name="cancel_reasons" class="cancel_reasons">
                                    <option value="select cancel reason">Select Reason</option>
                                    <option value="Ordered by mistake" >Ordered by mistake</option>
                                    <option value="Placed duplicate order">Placed duplicate order</option>
                                    <option value="Selected wrong size">Selected wrong size</option>
                                    <option value="Changed my mind">Changed my mind</option>
                                    <option value="Found a better price elsewhere">Found a better price elsewhere</option>
                                    <option value="No longer needed">No longer needed</option>
                                    <option value="Want to reorder with different payment method">Want to reorder with different payment method</option> `;

        model_quantity_html += '</select><span id="cancel_reason_error" class="text-danger"></span><span id="cancel_qty_success" class= "text-success"></span>';
      }
    } 
    modal.find('.modal-body').html(model_quantity_html);
  }

  $(document).on('change', '#cancel_qty', function() {
    $(this)
      .parent()
      .parent()
      .find('#cancelled_qty')
      .val($(this).val());
  });
  $(document).on('change', '#return_qty', function() {
    $('#returned_qty').val($(this).val());
  });
  $(document).on('change', '#return_reason', function() {
      if($('#return_reason').val() == "Others"){
        $("#return_reason_error").text("");
        $("#other_reason").show();
      }
      else{
        $("#return_other_reason_error").text("");
        $("#other_reason").hide();
      }
      console.log("return reason",$('#return_reason').val());
  });
  // cancel reasons
  $(document).on('change', '.cancel_reasons', function() {
      if($('.cancel_reasons').val() == "Other"){
        $("#return_reason_error").text("");
        $("#other_cancel_reason").show();
      }
      else{
        $("#cancel_other_reason_error").text("");
        $("#other_cancel_reason").hide();
      }
      console.log("cancel reason",$('.cancel_reasons').val());
  });

  $(document).on('click', '.return_order_line_item', function() { 
    let $btn = $('.return_order_line_item');
    let $siblingBtn = $btn.siblings('.btn');

    // Disable buttons
    $btn.prop('disabled', true);
    $siblingBtn.prop('disabled', true);

    setTimeout(function() {
        $btn.prop('disabled', false);
        $siblingBtn.prop('disabled', false);
    }, 8000);

    // Fetching values from the form
    let order_gateway = "{{ order.gateway }}";
    let shopify_order_id = $('#return_shopify_order_id').val();
    let line_sku = $('#sku').val();
    let return_qty = $('#returned_qty').val();
    let order_number = $('#order_number_return').val();
    let customer_email = $('#customer_email').val();
    let final_awb = $('#item_final_awb').val();
    let phone = $('#phone').val();
    let name = $('#name').val();
    let return_reason = $('#return_reason').val();
    {% assign order_tag = order.tags %}
      let order_tags = "{{ order_tag }}" ;
    console.log(order_tags );
    // If reason is "Others", get the custom reason
    if (return_reason === "Others") {
        return_reason = $('#other_reason').val().trim();
    }

    let cust_acc_name = "", acc_no = "", ifsc_code = "";

    // If payment mode is COD, get bank details
    if (order_gateway === "Cash on Delivery (COD)" || order_tags.includes("COD") ) {
        cust_acc_name = $('#cust_acc_name').val().trim();
        acc_no = $('#acc_no').val().trim();
        ifsc_code = $('#ifsc_code').val().trim();
    }

    let error = 0;

    // Validate Return Reason
    if (return_reason === "" || return_reason === "Choose Reason") {
        $("#return_reason_error").text("Please Select Return Reason");
        error = 1;
    }
    else {
        $("#return_reason_error").text("");
    }
    if ($('#return_reason').val() === "Others" && return_reason === "") {
        $("#return_other_reason_error").text("Please Write Return Reason");
        error = 1;
    } 
    else {
        $("#return_other_reason_error").text("");
    }
    // Validate COD bank details
    if (order_gateway === "Cash on Delivery (COD)" || order_tags.includes("COD") ) {
        if (!cust_acc_name) {
            $("#cust_acc_name_error").text("Please Enter Account Name");
            error = 1;
        } 
        else {
            $("#cust_acc_name_error").text("");
        }
        if (!acc_no) {
            $("#acc_no_error").text("Please Enter Account Number");
            error = 1;
        }
        else {
            $("#acc_no_error").text("");
        }
        if (!ifsc_code) {
            $("#ifsc_code_error").text("Please Enter IFSC Code");
            error = 1;
        }
        else {
            $("#ifsc_code_error").text("");
        }
    }

    // Validate return quantity
    if (return_qty <= 0) {
        $("#return_qty_error").text("Please Select Return Quantity");
        $('#return_line_modal').modal('show');
        error = 1;
    } else {
        $("#return_qty_error").text("");
    }

    if (error === 0) {
        $("#return_qty_success").text(return_qty + " Quantity returned");

        $.ajax({
            url: 'https://admin3157.gocolors.com/new_go_colors_india/public/api/order-line-item-changes-shiprocket',
            type: 'POST',
            dataType: 'json',
            data: {
                shopify_order_id,
                line_sku,
                return_qty,
                type: 'return',
                order_number,
                return_reason,
                customer_email,
                cust_acc_name,
                acc_no,
                ifsc_code,
                customer_name: name,
                phone,
                final_awb
            },
            beforeSend: function() {
                console.log("Before send");
                $(".order_loader").addClass('fa fa-spinner fa-spin');
                $('.return_ini').text('Return is Initiated');
                $('.modal-content table').hide();
            },
            success: function(resp) {
                console.log("Response received: ", resp);

                if (!resp.success) {
                    console.log('Return failed');
                    window.location.reload();
                } else {
                    console.log('Return successful');
                    $('.return_ini').text('');
                    $('.order_loader').show();
                    $(".loader").removeClass('fa fa-spinner fa-spin');
                    window.location.reload();
                }
            },
            error: function() {          
                console.log("Error occurred during request");
                $(".order_loader").removeClass('fa fa-spinner fa-spin');
                window.location.reload();
            }
        });
    }
});

  $(document).on('click','.no-btn', function(event){
       event.preventDefault();
     /// console.log('no');
      $('#return_line_modal').hide();
       $('#cust_acc_name').val('');
      $('#acc_no').val('');
      $('#ifsc_code').val('');
      $('#cancel_line_modal').hide();     
    });
  $(document).ready(function() {
      $('.cancel_order_line_item').on('click  touchstart', function() {
      $('.cancel_order_line_item').attr('disabled', 'disabled');
      $('.btn-secondary').attr('disabled', 'disabled');
      var modal = $('#cancel_line_modal');
      $("#cancel_reason_error,#cancel_qty_error").text('');
      $("#return_spiner_add").addClass('fa fa-spinner fa-spin');
      $(".return_button_disabled").prop('disabled', true);
      var main_div = $(this).parent().parent();
      var shopify_order_id = main_div.find('#shopify_order_id').val();
      var line_sku = main_div.find('#line_sku').val();
      var cancelled_qty = main_div.find('#cancelled_qty').val();
      var order_number = main_div.find('#order_number').val();
      var type = main_div.find('#modal_type').val();
      let selected_cancel_reason = true;
       let return_reason = $('.cancel_reasons').val();
      if (cancelled_qty <= 0) { 
        $("#cancel_qty_error").text("Please Select Quantity");
        $('#cancel_line_modal').modal('show');
        $('.cancel_order_line_item').removeAttr('disabled');
        $('.btn-secondary').removeAttr('disabled');
      } else {
      //  window.location.reload();
        $('.cancel_order_line_item').removeAttr('disabled');
        $('.btn-secondary').removeAttr('disabled');
      }
      if (return_reason === "" || return_reason === "select cancel reason") {
          $("#cancel_reason_error").text("Please Select Return Reason");
          selected_cancel_reason = false;
      }
      else {
          $("#cancel_reason_error").text("");
      }
      if (return_reason === "Other") {
          return_reason = $('#other_cancel_reason').val().trim();
          if (return_reason === "") {
           $("#cancel_other_reason_error").text("Please Write Return Reason");
           selected_cancel_reason = false;
            console.log(return_reason + " return_reason");
          }
          else {
            $("#cancel_other_reason_error").text("");
          }
      } 
      
      if (cancelled_qty > 0 && return_reason != '' && selected_cancel_reason == true ) {
        console.log(selected_cancel_reason+ " selected_cancel_reason "+ return_reason);
      
         $.ajax({
          // url: 'https://admin3157.gocolors.com/new_go_colors_india/public/api/order-line-item-changes',
         url: 'https://admin3157.gocolors.com/new_go_colors_india/public/api/order-line-item-changes-shiprocket',
          // url: 'https://4626-103-250-147-248.in.ngrok.io/api/order-line-item-changes',
  
          type: 'post',
          dataType: 'json',
          data: {
            'shopify_order_id': shopify_order_id,
            'line_sku': line_sku,
            'cancelled_qty': cancelled_qty,
            'type': type,
            'order_number': order_number,
            'return_reason':return_reason
          },
          beforeSend: function() {
            $(".order_loader").addClass('fa fa-spinner fa-spin');
             $('.return_ini').text('Cancel is Initiated');
            $('#cancel_line_modal .modal-body').hide();
            $('#cancel_line_modal .modal-footer').hide();
            
          },
          success: function(resp) {
        
            console.log("resp_cancel_funct"+resp);
            $("#cancel_qty_success").text(cancelled_qty + " Quantity canceled");
            if (resp.success == false) {
              console.log("resp_false");
              console.log(resp);
              console.log('BI01');
              $('#cancel_line_modal .modal-body').show();
            $('#cancel_line_modal .modal-footer').show();
               window.location.reload();
            } 
            else {
             window.location.reload();
              console.log("resp_false_else"+resp);
              console.log(resp);
              var modal_id = $('#cancel_line_modal');
              var loader = '<div class = "order_loader"></div>';
              $('.order_loader').show();
              $('.return_ini').text('');
              $(".loader").removeClass('fa fa-spinner fa-spin');
               }
  
          },
          error: function(respObj) {
         window.location.reload();
            console.log("respObj_error"+respObj);
            $(".order_loader").removeClass('fa fa-spinner fa-spin');
                      }
        })  
        
      }
    });
  
      });
</script>