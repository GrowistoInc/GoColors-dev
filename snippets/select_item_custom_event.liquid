{% assign collectionsName = blank %}
            {% for collection in product.collections %}
              {% if product.collections.size > 1 %}
                {% if forloop.index == 1  %}
                  {% assign collectionsName = collectionsName | append : collection.title %}
                  {% else %}
                  {% assign collectionsName = collectionsName | append : ', ' | append : collection.title  %}
                {% endif %}
              {% else %}
                  {% assign collectionsName = product.collections[0].title %}
              {% endif %}
{% endfor %}
  <script>
    window.collectionsName = {
      value:'{{ collectionsName }}' }

  </script>

  <script>
document.addEventListener("click", function (e) {

  const productCard = e.target.closest(".card-wrapper");
  if (!productCard) return;

  const productLink = productCard.querySelector('a[href*="/products/"]');
  if (!productLink) return;

  const productName =
    productCard.querySelector(".similar-product-title a")?.innerText.trim() ||
    productCard.querySelector(".card__heading a")?.innerText.trim() ||
    "NA";

  const priceText =
    productCard.querySelector(".price-item--sale")?.innerText ||
    productCard.querySelector(".price-item--regular")?.innerText ||
    "";

  const price = Number(priceText.replace(/[^0-9.]/g, ""));
  const productUrl = productLink.getAttribute("href");

  /* ✅ FIX HERE */
  const collectionsArr = window.collectionsName?.value
    ? window.collectionsName.value.split(',').map(v => v.trim())
    : [];

  const itemCategories = {};
  collectionsArr.forEach((value, index) => {
    itemCategories[`item_category${index + 1}`] = value;
  });

  console.log('collections value =>', window.collectionsName?.value);
  console.log('collectionsArr =>', collectionsArr);
  console.log('itemCategories =>', itemCategories);

  const item = {
    item_id: productUrl.split("/products/")[1],
    item_name: productName,
    affiliation: "{{ shop.name }}",
    item_brand: "{{ shop.name }}",
    price: price,
    quantity: 1,
    item_list_id: "collection_page",
    item_list_name: "{{ collection.title | default: 'Collection' }}",
    ...itemCategories ,
    location_id: window.location.href 
  };

  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push({
    event: "select_item",
    ecommerce: {
      items: [item]
    }
  });

  console.log("✅ select_item fired", item);
});

</script>