{% if collection %}
<script>
document.addEventListener("DOMContentLoaded", function () {

  window.dataLayer = window.dataLayer || [];

  var items = [
    {% for product in collection.products %}
    {
      item_id: "{{ product.id }}",
      item_name: "{{ product.title | escape }}",
      affiliation: "Online Store",
      coupon: "",
      discount: 0,
      index: {{ forloop.index }},
      item_brand: "{{ product.vendor | escape }}",
      item_category: "{{ collection.title | escape }}",
      item_category2: "{{ collection.handle }}",
      item_category3: "NA",
      item_category4: "NA",
      item_category5: "NA",
      item_list_id: "{{ collection.id }}",
      item_list_name: "{{ collection.title | escape }}",
      item_variant: "{{ product.selected_or_first_available_variant.title | escape }}",
      location_id: "online_store",
      price: {{ product.price | divided_by: 100.0 }},
      quantity: 1
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];

  dataLayer.push({
    event: "view_item_list",
    currency: "{{ cart.currency.iso_code | default: 'INR' }}",
    item_list_id: "{{ collection.id }}",
    item_list_name: "{{ collection.title | escape }}",
    items: items
  });

  console.log("âœ… view_item_list fired", items);

});
</script>
{% endif %}
