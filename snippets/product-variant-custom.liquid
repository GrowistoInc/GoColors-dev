{%- unless product.has_only_default_variant -%}
    <div>
      {%- for option in product.options_with_values -%}
        {%- liquid
          assign swatch_count = option.values | map: 'swatch' | compact | size
          assign picker_type = 'swatch_dropdown'
        -%}
          <div class="product-form__input product-form__input--dropdown">
            <label class="form__label hidden" for="Option-{{ section.id }}-{{ forloop.index0 }}">
              {{ option.name }}
            </label>
            <div class="select">
              {%- if picker_type == 'swatch_dropdown' -%}
                <span
                  data-selected-dropdown-swatch="options[{{ option.name | escape }}]"
                  class="dropdown-swatch hidden"
                >
                  {% render 'swatch', swatch: option.selected_value.swatch %}
                </span>
              {%- endif -%}
              <select
                id="Option-{{ section.id }}-{{ forloop.index0 }}"
                class="select__select fbt-options"
                name="options[{{ option.name | escape }}]"
                form="{{ product_form_id }}"
              >
                 <option value="">Select {{option.name}}</option> 
               {% comment %} <option value="">Select Size</option>{% endcomment %}
                {%- liquid
                    assign variants_available_arr = product.variants | map: 'available'
                    assign variants_option1_arr = product.variants | map: 'option1'
                    assign variants_option2_arr = product.variants | map: 'option2'
                    assign variants_option3_arr = product.variants | map: 'option3'
                  
                    assign product_form_id = 'product-form-' | append: section.id
                  -%}
                  {%- for value in option.values -%}
                    {%- liquid
                      assign option_disabled = true
                  
                      for option1_name in variants_option1_arr
                        case option.position
                          when 1
                            if variants_option1_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                              assign option_disabled = false
                            endif
                          when 2
                            if option1_name == product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                              assign option_disabled = false
                            endif
                          when 3
                            if option1_name == product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == product.selected_or_first_available_variant.option2 and variants_option3_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                              assign option_disabled = false
                            endif
                        endcase
                      endfor
                  
                      if value.swatch.image
                        assign image_url = value.swatch.image | image_url: width: 50
                        assign swatch_value = 'url(' | append: image_url | append: ')'
                      elsif value.swatch.color
                        assign swatch_value = 'rgb(' | append: value.swatch.color.rgb | append: ')'
                      else
                        assign swatch_value = nil
                      endif
                    -%}
                     <option
                       data-cprice="{{ value.variant.compare_at_price }}"
                       data-price="{{ value.variant.price }}"
                        value="{{ value | escape }}"
                        {% if forloop.index == 1 %}
                          selected="selected"
                        {% endif %}
                        {% if option_disabled %}
                          disabled
                        {% endif %}
                        {% if swatch_value and picker_type == 'swatch_dropdown' %}
                          data-option-swatch-value="{{ swatch_value }}"
                        {% endif %}
                      >
                        {% if option_disabled -%}
                          {{- 'products.product.value_unavailable' | t: option_value: value -}}
                        {%- else -%}
                          {{- value -}}
                        {%- endif %}
                      </option>
                   
                  {%- endfor -%}
              </select>
              {% render 'icon-caret' %}
            </div>
          </div>
      {%- endfor -%}
      <script type="application/json">
        {{ product.variants | json }}
      </script>
    </div>
  {%- endunless -%}
  
  <noscript class="product-form__noscript-wrapper-{{ section.id }}">
    <div class="product-form__input{% if product.has_only_default_variant %} hidden{% endif %}">
      <label class="form__label" for="Variants-{{ section.id }}">
        {{- 'products.product.product_variants' | t -}}
      </label>
      <div class="select">
        <select
          name="id"
          id="Variants-{{ section.id }}"
          class="select__select"
          form="{{ product_form_id }}"
        >
          {%- for variant in product.variants -%}
            <option
              {% if variant == product.selected_or_first_available_variant %}
                selected="selected"
              {% endif %}
              {% if variant.available == false %}
                disabled
              {% endif %}
              value="{{ variant.id }}"
              v-title="{{ variant.title }}"
            >
              {%- liquid
                echo variant.title
                echo variant.price | money | strip_html | prepend: ' - '
                if variant.available == false
                  echo 'products.product.sold_out' | t | prepend: ' - '
                endif
                if variant.quantity_rule.increment > 1
                  echo 'products.product.quantity.multiples_of' | t: quantity: variant.quantity_rule.increment | prepend: ' - '
                endif
                if variant.quantity_rule.min > 1
                  echo 'products.product.quantity.minimum_of' | t: quantity: variant.quantity_rule.min | prepend: ' - '
                endif
                if variant.quantity_rule.max != null
                  echo 'products.product.quantity.maximum_of' | t: quantity: variant.quantity_rule.max | prepend: ' - '
                endif
                # TODO: enable theme-check once `item_count_for_variant` is accepted as valid filter
                # theme-check-disable
                assign cart_quantity = cart | item_count_for_variant: variant.id
                # theme-check-enable
                if cart_quantity > 0
                  echo 'products.product.quantity.in_cart_html' | t: quantity: cart_quantity | prepend: ' - '
                endif
              -%}
            </option>
          {%- endfor -%}
        </select>
        {% render 'icon-caret' %}
      </div>
    </div>
  </noscript>
  