// REMOVED FROM CART
document.addEventListener("DOMContentLoaded", function () {
  const isCartPage = window.location.pathname.includes('/cart');
  if (!isCartPage) return;
 
  const removeButtons = document.querySelectorAll('[href*="quantity=0"]');

  removeButtons.forEach((btn) => {
    btn.addEventListener("click", function (e) {
      e.preventDefault();

      const row = btn.closest('.cart-item');
      if (!row) return;
 
      const urlParams = new URLSearchParams(btn.href.split('?')[1]);
      const idParam = urlParams.get('id'); // format: VARIANT_ID:HASH
      const variantId = idParam?.split(':')[0];

      if (!variantId) return;
 
      let specifications = [];
      let selectedSize = 'NA';

      const options = row.querySelectorAll('.cart-item__options .cart-item__option-name');
      options.forEach((labelEl) => {
        const label = labelEl?.innerText?.trim();
        const value = labelEl?.nextElementSibling?.innerText?.trim();
        if (label && value) {
          if (label.toLowerCase() === 'size') {
            selectedSize = value;
          } else {
            specifications.push(`${label}: ${value}`);
          }
        }
      });

      const specFinal = specifications.length ? specifications.join(', ') : 'NA';
 
      const meta = JSON.parse(sessionStorage.getItem(`product_meta_${variantId}`)) || {};

      const itemListName = sessionStorage.getItem('item_list_name') || 'home_default';
      const itemListId = sessionStorage.getItem('item_list_id') || 'default';

      const payload = {
        page_type: 'cart',
        item_list_name: itemListName,
        item_list_id: itemListId,
        userID: '{{ customer.id }}',
        user_type: '{{ customer.tags | join: "," | default: "guest" }}',
        items: [{
          item_id: variantId,
          item_name: row.querySelector('.cart-item__title')?.innerText.trim() || 'NA',
          item_brand: meta.item_brand || 'Powerlook',
          item_category: meta.item_category || 'Shirts',
          item_category2: meta.item_category2 || 'NA',
          item_category3: specFinal,
          item_category4: selectedSize,
          item_category5: meta.item_category5 || 'Men',
          price: parseFloat(
            row.querySelector('.price')?.innerText.replace(/[^\d.]/g, '')
          ) || 0,
          quantity: parseInt(
            row.querySelector('input.quantity__input')?.value
          ) || 1,
          discount: 0
        }]
      };

      gtag('event', 'remove_from_cart', payload);
     // console.log('üóëÔ∏è GA4 remove_from_cart event fired:', payload);
 
      window.location.href = btn.href;
    });
  });
});  
// REMOVED FROM CART