const LOGIN_IFRAME_HOST="https://pdp.gokwik.co/checkout-enhancer/index.html",HITS_HOST="https://hits.gokwik.co",KWIK_SESSION_TOKEN_KEY="KWIKSESSIONTOKEN",KWIK_SIGNED_IN="KWIKSIGNEDIN",TRUECALLER_PARTNER_KEY="8mf4fc98b53b622d94edc87c225d6096325f8",API_URL="https://prod-shp-checkout.gokwik.co",AB_SERVICE_HOST="https://gkx.gokwik.co",gkModal=document.getElementById("gk-modal"),gkBtn=document.getElementById("gk-open-modal-btn");let currentCartGk,requestId,gkExpCustomerId,gkCart,redirectingToCheckoutFlag=!1,isTenDigitPhoneFormat=!1,gKuserExperiments=[],gkVariant={},gkCss="",gkABTestingEnabled="",gkMerchantId=window.gkMerchantId;const gk_merchant_url=new URL(window.location.href),gkMktMedium=gk_merchant_url.searchParams.get("utm_medium"),gkMktSource=gk_merchant_url.searchParams.get("utm_source"),gkMktCampaign=gk_merchant_url.searchParams.get("utm_campaign"),gkMktTerm=gk_merchant_url.searchParams.get("utm_term"),gkMktContent=gk_merchant_url.searchParams.get("utm_content"),gkSource=gk_merchant_url.href,gkLandingPage=gk_merchant_url.origin,adSource=window.location.href.split("?").length>1?window.location.href.split("?")[1]:void 0;async function gkGetSetUserId(){localStorage.getItem("gk_user_id")?gkExpCustomerId=localStorage.getItem("gk_user_id"):(gkExpCustomerId=Math.floor(1e15+9e15*Math.random()).toString(),localStorage.setItem("gk_user_id",gkExpCustomerId))}null!==gkMktMedium&&sessionStorage.setItem("gkMktMedium",gkMktMedium),null!==gkMktSource&&sessionStorage.setItem("gkMktSource",gkMktSource),null!==gkMktCampaign&&sessionStorage.setItem("gkMktCampaign",gkMktCampaign),null!==gkMktTerm&&sessionStorage.setItem("gkMktTerm",gkMktTerm),null!==gkMktContent&&sessionStorage.setItem("gkMktContent",gkMktContent),null!==gkSource&&sessionStorage.setItem("gkSource",gkSource),null!==gkLandingPage&&sessionStorage.setItem("gkLandingPage",gkLandingPage);let experimentsApiConfig={getVariants:"/v3/experiment/api/get_user_variant",getExperiments:"/v3/experiment/api/experiments"},experimentVariants={SHIPROCKET_CHECKOUT:"shiprocket-checkout-button",KWIK_CHECKOUT:"kwik-checkout-button",SHOPIFY_NATIVE_CHECKOUT:"shopify-native-checkout",GOKWIK_CHECKOUT_ONE:"gokwik-checkout-one"};async function getUserExperiments(){try{const e=`${AB_SERVICE_HOST+experimentsApiConfig.getExperiments}?merchant_id=${window.gkMerchantId}`,t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","x-gokwik-origin":window.location.origin}}),n=await t.json();gKuserExperiments=Object.values(n?.data||{})}catch(e){console.error(e)}await fetchVariants("checkout_buttons_ab")}async function fetchVariants(e){switch(gkVariant=await getUserVariant(e),gKuserExperiments.length&&setAbTestingAttributes(gkExpCustomerId,gkVariant?.variant_name),gkVariant?.variant_name??""){case experimentVariants.SHIPROCKET_CHECKOUT:Decidefun(experimentVariants.SHIPROCKET_CHECKOUT,gkVariant?.user_id);break;case experimentVariants.KWIK_CHECKOUT:Decidefun(experimentVariants.KWIK_CHECKOUT,gkVariant?.user_id);break;case experimentVariants.SHOPIFY_NATIVE_CHECKOUT:Decidefun(experimentVariants.SHOPIFY_NATIVE_CHECKOUT,gkVariant?.user_id);break;case experimentVariants.GOKWIK_CHECKOUT_ONE:Decidefun(experimentVariants.GOKWIK_CHECKOUT_ONE,gkVariant?.user_id)}sessionStorage.setItem("assignedGkVariant",gkVariant?.variant_name??"")}function Decidefun(e,t){"shopify-native-checkout"===e?(gkCss="\n\t\t.gokwik-buynow-btn {display:none;}\n\t\t.gokwik_checkout_btn_ab {display:none;}\n\t\t.shopify_native_checkout_btn {display:flex !important;}\n\t\t.shopify_native_buynow_btn {display:flex !important;}\n\t\t",observeAndAttachEvent([".shopify_native_checkout_btn",".shopify_native_buynow_btn"],e,t)):"kwik-checkout-button"===e?(gkCss="\n\t\t.gokwik-buynow-btn {display:flex !important;}\n\t\t.gokwik_checkout_btn_ab {display:flex !important;}\n\t\t.shopify_native_checkout_btn {display:none !important;}\n\t\t.shopify_native_buynow_btn {display:none !important;}\n\t\t.gokwik_one_checkout_btn_ab {display:none !important;}\n\t\t.gokwik-one-buy-now {display:none !important;}\n\t\t",observeAndAttachEvent([".gokwik_checkout_btn_ab",".gokwik-buynow-btn"],e,t)):"gokwik-checkout-one"===e&&(gkCss="\n\t\t.gokwik-buynow-btn {display:none;}\n\t\t.gokwik_checkout_btn_ab {display:none;}\n\t\t.gokwik_one_checkout_btn_ab {display:flex !important;}\n\t\t.gokwik-one-buy-now {display:flex !important;}\n\t\t",observeAndAttachEvent([".gokwik_one_checkout_btn_ab",".gokwik-one-buy-now"],e,t));const n=document.createElement("style");n.textContent=gkCss,document.head.appendChild(n)}function observeAndAttachEvent(e,t,n){const o=new MutationObserver((a=>{e.forEach((e=>{const a=document.querySelector(e);a&&!a.dataset.eventListenerAdded&&(a.addEventListener("click",(()=>{experimentAnalyticsEvent(t,n),o.disconnect()})),a.dataset.eventListenerAdded="true")}))}));o.observe(document.body,{childList:!0,subtree:!0})}function experimentAnalyticsEvent(e,t){analyticsEvent({source:adSource,utm_medium:gkMktMedium,utm_source:gkMktSource,utm_campaign:gkMktCampaign,gkLandingPage:gkLandingPage,orig_referrer:document.referrer,shopifySessionId:window.gkShopifySessionId,eventType:"buttonClick",merchantId:window.gkMerchantId,name:"ab_checkout_started",type:"event",data:{user_id:t,variant_name:e}},"")}async function getUserVariant(e){const t=gKuserExperiments.find((t=>t?.name===e));if(!t)return null;const{id:n}=t;if(!n)return null;if(t.is_deleted||t.is_concluded||new Date(t.start_date)>=new Date)return null;try{const e=await assignUserVariant(n);if(200==e.status_code){const t=e?.data;if(t?.variant_name)return t}}catch(e){console.error(e)}}async function assignUserVariant(e){if(!gkExpCustomerId)return;const t={experiment_id:e,user_attributes:{m_id:window.gkMerchantId},user_id:String(gkExpCustomerId)};try{const e=await fetch(AB_SERVICE_HOST+experimentsApiConfig.getVariants,{method:"POST",headers:{"Content-Type":"application/json","x-gokwik-origin":window.location.origin},body:JSON.stringify(t)});return await e.json()}catch(e){console.error(e)}}let gkIframe=document.getElementsByClassName("gk-login")[0];gkIframe.src=`${LOGIN_IFRAME_HOST}`,gkIframe.allow="otp-credentials";const kwikPassEmail=localStorage.getItem("kp_email");let gk_checkout_enhancer_cart={};document.getElementsByClassName("loader-content")[0].style.display="none";let isAddressPrefilled=!1,prefilledCustomerData={email:"",phone:"",shippingAddress:""};function setAbTestingAttributes(e,t){gkCart.attributes.exp_customer_id=e,gkCart.attributes.merchant_id=window.gkMerchantId,gkCart.attributes.variant_name=t,updateGkCart("","","",e,window.gkMerchantId,t)}window.addEventListener("load",(async()=>{if(gk_checkout_enhancer_cart=await fetchGkCart(),gkCart=gk_checkout_enhancer_cart,gkABTestingEnabled=window?.gkABTestingEnabled,"true"===gkABTestingEnabled){const e=sessionStorage.getItem("assignedGkVariant");if(e){let t=localStorage.getItem("gk_user_id");Decidefun(e,t),setAbTestingAttributes(t,e)}else await gkGetSetUserId(),getUserExperiments()}observeCartChanges();const e=[...document.getElementsByClassName("gk-close")];e.length&&e[0].remove()})),window.onpageshow=e=>{e.persisted&&(gkIframe.src=`${LOGIN_IFRAME_HOST}`,closeGkModal(!1))},window.addEventListener("unload",(function(e){redirectingToCheckoutFlag&&closeGkModal()}));const analyticsEvent=(e,t)=>{const n={...e,timestamp:Date.now(),requestId:t||"NA",userAgent:navigator.userAgent,version:"1"};fetch(HITS_HOST+"/api/v1/events",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})};async function initiateLogin(){if(gkCart=await fetchGkCart(),0===gkCart?.items.length)return;gkCart.attributes.shopify_session_id=window.gkShopifySessionId,gkCart.attributes.source="shopify_apps";const e=getGkDiscountCode();if(!gkCart?.token)return;const t={merchantDomain:window.location.origin,mid:window.gkMerchantId,cart:gkCart};setLocalStorage("KWIKSIGNEDIN",void 0);const n=await fetch(API_URL+"/v3/login/request",{method:"POST",headers:{Accept:"application.json","Content-Type":"application/json"},body:JSON.stringify(t)});200!==n.status&&(window.location.href="/checkout");const o=await n.json(),a=o.data.requestId;if(updateGkCart(a,window.gkShopifySessionId,window.gkCustomerEmail),200===o.statusCode&&a||(window.location.href="/checkout"),o?.data?.failsafe){let e=o?.data?.failsafe;if(e)return void(window.location.href=window.location.origin+"/checkout")}let i=API_URL+"/sa-login-ui/gk_sa_login.html?reqId="+a;const r=localStorage.getItem("kp_email");r&&(i=i+"&kpe="+r),e&&(i=i+"&cd="+e),isAddressPrefilled&&(i=i+"&iap="+isAddressPrefilled),gkIframe.contentWindow.postMessage({type:"utm_params",orig_referrer:document.referrer,mkt_source:sessionStorage.getItem("gkMktSource"),mkt_campaign:sessionStorage.getItem("gkMktCampaign"),mkt_medium:sessionStorage.getItem("gkMktMedium"),mkt_content:sessionStorage.getItem("gkMktContent"),mkt_term:sessionStorage.getItem("gkMktTerm"),source:sessionStorage.getItem("gkSource"),landing_page:sessionStorage.getItem("gkLandingPage")},LOGIN_IFRAME_HOST),gkIframe.contentWindow.postMessage({type:"merchant_url",url:window.location.href},LOGIN_IFRAME_HOST),gkCart.attributes.request_id=a,gkCart.attributes.shopify_customer=window.gkCustomerEmail,gkModal.style.display="block",document.body.style.overflow="hidden",document.getElementsByClassName("loader-content")[0].style.display="none",document.getElementsByClassName("gk-otp-popup")[0].style.display="block",gkIframe.contentWindow.postMessage({type:"popup-display-change",gkModalDisplay:"block"},LOGIN_IFRAME_HOST);const s=getGkCookiefn("KWIKSESSIONTOKEN");gkIframe.contentWindow.postMessage({domain:window.gkShopDomain,email:window.gkCustomerEmail,cart:gkCart,token:s,shopifySessionId:window.gkShopifySessionId,discountCode:getGkDiscountCode(),kwikPassEmail:kwikPassEmail,source:adSource,requestId:a},LOGIN_IFRAME_HOST),analyticsEvent({adSource:adSource,eventType:"onGkClick",merchantId:window.gkMerchantId,name:"gokwik-button-clicked",type:"event",shopifySessionId:window.gkShopifySessionId}),analyticsEvent({eventType:"onGkClick",merchantId:window.gkMerchantId,name:"checkout_initiated",type:"event",shopifySessionId:window.gkShopifySessionId,data:{source:"shopify_app",checkout_ui_type:"old"}},a),(window.location.origin.includes("babyforest")||window?.gkShopDomain?.includes("wellbeing")||window?.gkShopDomain?.includes("house-ofchikankari"))&&setTimeout((()=>{window.gk_utm_message_data={type:"utm_params",orig_referrer:document.referrer,mkt_source:sessionStorage.getItem("gkMktSource"),mkt_campaign:sessionStorage.getItem("gkMktCampaign"),mkt_medium:sessionStorage.getItem("gkMktMedium"),mkt_content:sessionStorage.getItem("gkMktContent"),mkt_term:sessionStorage.getItem("gkMktTerm"),source:sessionStorage.getItem("gkSource"),landing_page:sessionStorage.getItem("gkLandingPage")},gkIframe.contentWindow.postMessage({type:"utm_params",orig_referrer:document.referrer,mkt_source:sessionStorage.getItem("gkMktSource"),mkt_campaign:sessionStorage.getItem("gkMktCampaign"),mkt_medium:sessionStorage.getItem("gkMktMedium"),mkt_content:sessionStorage.getItem("gkMktContent"),mkt_term:sessionStorage.getItem("gkMktTerm"),source:sessionStorage.getItem("gkSource"),landing_page:sessionStorage.getItem("gkLandingPage")},LOGIN_IFRAME_HOST),window.gk_url_message_data={type:"merchant_url",url:window.location.href},gkIframe.contentWindow.postMessage({type:"merchant_url",url:window.location.href},LOGIN_IFRAME_HOST),window.gk_login_message_data={domain:window.gkShopDomain,email:window.gkCustomerEmail,cart:gkCart,token:s,shopifySessionId:window.gkShopifySessionId,discountCode:getGkDiscountCode(),kwikPassEmail:kwikPassEmail,source:adSource,requestId:a},gkIframe.contentWindow.postMessage({domain:window.gkShopDomain,email:window.gkCustomerEmail,cart:gkCart,token:s,shopifySessionId:window.gkShopifySessionId,discountCode:getGkDiscountCode(),kwikPassEmail:kwikPassEmail,source:adSource,requestId:a},LOGIN_IFRAME_HOST)}),800)}const initiateLogout=async()=>{setLocalStorage("KWIKSIGNEDIN",void 0),gkIframe.contentWindow.postMessage({type:"initiateLogout"},LOGIN_IFRAME_HOST)};async function onMessage(e){const t=e.data;if("redirectToCheckout"==e.data.func)window[t.func].call(null,t.message);else if("showLoginPopup"==e.data.func)document.getElementsByClassName("loader-content")[0].style.display="none",document.getElementsByClassName("gk-otp-popup")[0].style.display="block";else if("iframeLoaded"==e.data.func)!window.gkCustomerEmail&&getLocalStorage("KWIKSIGNEDIN")&&console.log("initiateLogout inside if");else if("foreignAnalytics"==e.data.func)initAnalyticsListener(e);else if("autoReadOtp"===e.data.func)autoReadOtp();else if("guest-checkout"===e.data.func){const n=getGkDiscountCode(),o=`/checkout?${n?"discount="+n+"&":""}${t?.phoneNumber?`checkout[shipping_address][phone]=${isTenDigitPhoneFormat?"":"%2b91"}${t?.phoneNumber}`:""}`;window.open(o,"_self"),e.data.skipCheckoutNoToken&&"19g6jls1kg1ew"!==e.data.mId&&closeGkModal()}else if("update-cart-req-id"===e.data.func)requestId=e.data.request_id,isTenDigitPhoneFormat=e.data?.isTenDigitPhoneFormat,updateGkCart(e.data.request_id,window.gkShopifySessionId,window.gkCustomerEmail);else if("showTruecallerPopup"===e.data.func){const t=await checkTrueCallerApp(e?.data?.message?.requestId);console.log(),t&&(gkIframe.contentWindow.postMessage({type:"trueCallerVerification",trueCallerRequestId:t},LOGIN_IFRAME_HOST),analyticsEvent({cartId:currentCartGk?.token,merchantId:window.gkMerchantId,requestId:e?.data?.message?.requestId,shopifySessionId:window.gkShopifySessionId,eventType:"click",name:"trueCallerVerify",type:"function"},e?.data?.message?.requestId))}else if("closeGkModal"===e.data.func)closeGkModal();else if("set_gk_storage"===e.data.func){let t=e?.data?.data?.cookie||null,n=e?.data?.data?.localStorage;t&&setGkCookieFn(t.name,t.value,t.expiry),n&&setLocalStorage(n.name,n.value)}else"hydrogen"===e.data.func&&setLocalStorage("GkHydrogen","true")}window.addEventListener&&window.addEventListener("message",onMessage,!1);const closeGkModal=async(e=!0)=>{document.body.style.overflow="auto",gkModal.style.display="none",gkIframe.contentWindow.postMessage({type:"close-login-window",gkModalDisplay:"none"},LOGIN_IFRAME_HOST),e&&analyticsEvent({cartId:currentCartGk?.token,merchantId:window.gkMerchantId,requestId:requestId,shopifySessionId:window.gkShopifySessionId,eventType:"click",name:"back_button_clicked",type:"function",data:{pageNo:"1"}},requestId)};async function fetchGkCart(){return new Promise(((e,t)=>{fetch("/cart.js",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((t=>{e(t)}))}))}async function updateGkCart(e,t,n,o,a,i){try{return new Promise(((r,s)=>{fetch("/cart/update.js",{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json;"},body:JSON.stringify({attributes:{requestId:e,shopifySessionId:t,shopifyCustomer:n,expCustomerId:o,merchantId:a,variantName:i}})}).then((e=>r()))}))}catch(e){console.log(e)}}async function redirectToCheckout(e){if(localStorage.getItem("GkHydrogen")){const t=new CustomEvent("verificationCompletedGK",{detail:e});window.dispatchEvent(t)}else{const t=getGkDiscountCode();if(e?.token&&(setLocalStorage("KWIKSIGNEDIN",!0),setGkCookieFn("KWIKSESSIONTOKEN",e?.token)),e?.email&&e?.password)fetch(`https://${window.gkShopDomain}/account/login?customer[email]=${e.email}&customer[password]=${e.password}`,{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.text())).then((n=>{n.includes("Log out")?(redirectingToCheckoutFlag=!0,window.location.href=`https://${window.gkShopDomain}/checkout?${t?"discount="+t+"&":""}checkout[shipping_address][phone]=${isTenDigitPhoneFormat?"":"%2b91"}${e?.phone}`):gkIframe.contentWindow.postMessage({domain:window.gkShopDomain,email:window.gkCustomerEmail,cart:gkCart,reGenerateLogin:!0},"*")})).catch((e=>{console.log("error",e)}));else if(e?.multipass)if(window.gkCustomerEmail)redirectingToCheckoutFlag=!0,window.location.href="/checkout?"+(t?"discount="+t+"&":"");else{const n=e?.multipass?.split("/account")[1],o=window.location.origin+"/account"+n;fetch(o,{method:"GET",headers:{"Content-Type":"application/json"}}).finally((()=>{redirectingToCheckoutFlag=!0,window.location.href="/checkout?"+(t?"discount="+t+"&":"")}))}else if(e?.cartParamCheckoutLink){const n=new URLSearchParams(e?.cartParamCheckoutLink);if(["checkout[shipping_address][address1]","checkout[shipping_address][first_name]","checkout[shipping_address][province]","checkout[shipping_address][city]","checkout[shipping_address][phone]","checkout[shipping_address][zip]"].some((e=>n.has(e)))){const t=e.requestId;analyticsEvent({eventType:"onLoad",merchantId:window.gkMerchantId,name:"addressPrefill",type:"event",shopifySessionId:window.gkShopifySessionId},t)}const o=e.cartParamCheckoutLink?.replace(/(\/checkout\?)/,"$1"+(t?"discount="+t+"&":""));redirectingToCheckoutFlag=!0,window.location.href=o}else"new"==e?.userType&&(redirectingToCheckoutFlag=!0,window.location=`https://${window.gkShopDomain}/checkout?${t?"discount="+t+"&":""}checkout[shipping_address][phone]=${isTenDigitPhoneFormat?"":"%2b91"}${e?.phone}${e.email?"&checkout[email]="+e?.email:""}`)}}function getGkDiscountCode(){let e={};document.cookie.split(";").forEach((function(t){let[n,o]=t.split("=");e[n.trim()]=o}));return e.discount_code||e.coupon_applied||e["applied-coupons"]}function setLocalStorage(e,t){"undefined"!=typeof localStorage&&localStorage.setItem(e,t)}function getLocalStorage(e){if("undefined"!=typeof localStorage){const t=localStorage.getItem(e);return t||null}return null}const initAnalyticsListener=async e=>{const t=gk_checkout_enhancer_cart;callAnalyticsService(e.data?.service,e?.data?.eventName,{...e.data.data,cart:t})},callAnalyticsService=(e,t,n)=>{switch(e){case"contlo":fireContloEvent(t,n);break;case"fb":fireFbEvent(t,n);break;case"ga4":fireGa4Event(t,n);break;case"webEngage":firewebEngageEvent(t,n);break;case"moengage":fireMoenageEvent(t,n)}},fireMoenageEvent=(e,t)=>{window.location.origin.includes("simpleskin")&&"OTP_login"===e&&(moengageOtpLoginEvent(e,t),console.log("Moengage OTP_Login event"))},moengageOtpLoginEvent=(e,t)=>{let n={"Mobile Number":parseInt(t.mobileNumber),"Gokwik First Time User":t.firstTimeUser,Channel:"Gokwik"};null!==gkMktSource&&(n.UTM_Source=gkMktSource),null!==gkMktCampaign&&(n.UTM_Medium=gkMktCampaign),null!==gkMktMedium&&(n.UTM_Medium=gkMktMedium);try{console.log("MOENGAGE GK"),Moengage.track_event(e,n),console.log("MOENGAGE OTP EVENT")}catch(e){const n=t.response;n.data?.multipass?redirectToCheckout({multipass:n.data.multipass,requestId:n.requestId,token:n.data.token}):n.data?.cartParamCheckoutLink?redirectToCheckout({cartParamCheckoutLink:n.data.cartParamCheckoutLink,requestId:n.requestId,token:n.data.token}):n.data?.email&&n.data?.password?redirectToCheckout({email:n.data?.email,password:n.data?.password,otpVerifiedResposne:n,token:n.data.token}):"new"==n.data?.userType&&redirectToCheckout({userType:n.data?.userType,requestId:n.requestId,token:n.data.token,phone:n.mobileNumber})}const o=t.response;o.data?.multipass?redirectToCheckout({multipass:o.data.multipass,requestId:o.requestId,token:o.data.token}):o.data?.cartParamCheckoutLink?redirectToCheckout({cartParamCheckoutLink:o.data.cartParamCheckoutLink,requestId:t.requestId,token:o.data.token}):o.data?.email&&o.data?.password?redirectToCheckout({email:o.data?.email,password:o.data?.password,otpVerifiedResposne:o,token:o.data.token}):"new"==o.data?.userType&&redirectToCheckout({userType:o.data?.userType,requestId:o.requestId,token:o.data.token,phone:t.mobileNumber}),console.log("REDIRECTION EVENT")},firewebEngageEvent=(e,t)=>{"phone_number_entered"===e&&"phone"==t?.webengageLoginType?webengagePhoneNumberEntered(t):"otp-verified-gk"===e&&"phone"==t?.webengageLoginType&&webengageOtpVerifiedEvent(t)},webengagePhoneNumberEntered=e=>{let t={mobile_number:e.phoneNumber,currency:"INR",tag:"GoKwik",cart_total_price:(parseInt(e?.cart?.original_total_price)/100).toFixed(2),items:createItemsBody(e.cart)};webengage.track("Mobile_Added_GK",t)},webengageOtpVerifiedEvent=e=>{let t={mobile_number:e.phoneNumber,currency:"INR",tag:"GoKwik",cart_total_price:(parseInt(e?.cart?.original_total_price)/100).toFixed(2),items:createItemsBody(e.cart)};webengage.track("OTP_Verified_GK",t)},fireGa4Event=(e,t)=>{"phone_number_entered"===e?ga4MobileNumberEntered(t):"otp-verified-gk"===e&&ga4OtpVerifiedEvent(t)},ga4MobileNumberEntered=e=>{let t={mobile_number:e.phoneNumber,currency:"INR",tag:"GoKwik",original_total_price:(parseInt(e?.cart?.original_total_price)/100).toFixed(2),items:createItemsBody(e.cart),cart_item_count:e?.cart?.item_count,total_discount:e?.cart?.discount_code};window.gtag("event","login_mobile_entered_gk",t)},ga4OtpVerifiedEvent=e=>{let t={mobile_number:e.phoneNumber,currency:"INR",tag:"GoKwik",original_total_price:(parseInt(e?.cart?.original_total_price)/100).toFixed(2),items:createItemsBody(e.cart),cart_item_count:e?.cart?.item_count,total_discount:e?.cart?.discount_code};window.gtag("event","login_otp_verified_gk",t)},createItemsBody=e=>{const t=e.items;if(t.length)return t?.map((e=>({product_id:e.product_id||"NA",product_variant_id:e.variant_id,product_name:e.title,product_variant:e.variant_title||"NA",product_quantity:e.quantity,product_url:e.url,product_image_url:e.image,product_price:+e.final_price/100,coupon:e?.discounts[0]?.title||"NA"})))},fireFbEvent=(e,t)=>{"init-checkout"===e&&initCheckout(t)},initCheckout=e=>{console.log("Fb Pixel==>","track","beginCheckout",{currency:"INR",tag:"GoKwik",cart_total_price:(parseInt(e?.cart?.original_total_price)/100).toFixed(2),items:e.cart?.items?.map((e=>({product_id:e.product_id||"NA",product_variant_id:e.variant_id,product_name:e.title,product_variant:e.variant_title||"NA",product_quantity:e.quantity,product_url:e.url,product_image_url:e.image,product_price:+e.final_price/100,coupon:e?.discounts[0]?.title||"NA"})))},{eventID:`Gokwik ${Math.random()}`}),fbq("track","beginCheckout",{currency:"INR",tag:"GoKwik",cart_total_price:(parseInt(e?.cart?.original_total_price)/100).toFixed(2),items:e.cart?.items?.map((e=>({product_id:e.product_id||"NA",product_variant_id:e.variant_id,product_name:e.title,product_variant:e.variant_title||"NA",product_quantity:e.quantity,product_url:e.url,product_image_url:e.image,product_price:+e.final_price/100,coupon:e?.discounts[0]?.title||"NA"})))},{eventID:`Gokwik ${Math.random()}`})},fireContloEvent=(e,t)=>{"phone_number_entered"===e&&phoneNumberEnteredEvent(t)},phoneNumberEnteredEvent=e=>{let t={eventName:"mobile_added_gk",data:createBody(e)};window.contlo?.sendAsyncEvent(t.eventName,"",t?.data?.phoneNumber,t.data).then((t=>{"new"===e?.redirectData?.userType&&redirectToCheckout(e?.redirectData)}))},createBody=e=>{let t=[];return e?.cart?.items?.map((e=>{t=[...t,`${e.id}`]})),{tag:"GoKwik",cart_total_price:e?.cart?.original_total_price,product_id:t||[],first_name:"",last_name:"",email:"",full_address:"",city:"",state:"",address_type:"",shipping_method:"",abc_url:"",pincode:"",...e}},autoReadOtp=async()=>{if("OTPCredential"in window){analyticsEvent({cartId:currentCartGk?.token,merchantId:window.gkMerchantId,requestId:requestId,shopifySessionId:window.gkShopifySessionId,eventType:"click",name:"auto_read_otp_shown",type:"function",data:{page:"2"}},requestId);const e=new AbortController;let t={otp:{transport:["sms"]},signal:e.signal};navigator.credentials.get(t).then((t=>{let n={type:"prefillOtp",data:t.code};dispatchIframeEvent(n),e.abort()})).catch((t=>{e.abort()}))}},dispatchIframeEvent=e=>{gkIframe.contentWindow.postMessage(e,"*")},checkTrueCallerApp=async e=>new Promise((t=>{const n="trc-"+e;window.location.href=`truecallersdk://truesdk/web_verify?type=btmsheet&requestNonce=${n}&partnerKey=${TRUECALLER_PARTNER_KEY}&partnerName=Gokwik&lang=en&skipOption=useanothernum&ctaPrefix=continuewith&btnShape=rect&ctaColor=%23000000"`,setTimeout((()=>{document.hasFocus()?t(null):t(n)}),600)}));function emitCartChanges(){window.location.pathname.includes("/cart")&&fetch("/cart.js").then((e=>{e.json().then((e=>{gk_checkout_enhancer_cart=e})).catch((e=>console.log(e)))})).catch((e=>console.log(e)))}function observeCartChanges(){new PerformanceObserver((e=>{e.getEntries().forEach((e=>{const t=["xmlhttprequest","fetch"].includes(e.initiatorType),n=/\/cart\//.test(e.name);t&&n&&emitCartChanges()}))})).observe({entryTypes:["resource"]})}function setGkCookieFn(e,t,n){const o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);let a="expires="+o.toUTCString();document.cookie=e+"="+t+";"+a+";path=/"}function getGkCookiefn(e){let t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let o=n[e];for(;" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}