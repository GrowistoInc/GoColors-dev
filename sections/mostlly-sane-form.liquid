<style>
#shopify-{{ section.id }}{padding-block:{{ section.settings.padding_top_mob }}px  {{ section.settings.padding_bottom_mob }}px}.mostysaneForm{;padding:0 20px;}.mostysaneForm h3{text-align: center}.mostysaneForm label{display:block;padding-bottom: 5px;}.mostysaneForm input {border: 1px solid;width: -webkit-fill-available;padding: 10px 20px; min-height: 40px;max-height:40px;margin-bottom: 10px;border-radius:0;}.mostysaneForm input[type="checkbox"] {width:20px;max-width: 20px;max-height: 20px;min-width: 20px;min-height: 20px; border-radius:0 !important;}.mostysaneForm button {width: 200px;margin: 2rem auto 2rem;display: flex;align-items: center;justify-content: center; background: #df2e84;border: 1px solid #df2e84;color: #fff;border-radius: 25px; height: 40px;}.checkbox_val{font-size:14px;}.mostysaneForm label.checkbox_val{display: flex;gap: 5px;line-height: 21px}
@media screen and (min-width:1200px){
  .mostysaneForm{ max-width:450px;margin:0 auto;}#shopify-{{ section.id }}{padding-block:{{ section.settings.padding_top }}px  {{ section.settings.padding_bottom }}px}
}
@media screen and (max-width: 1200px) {
  input[type="date"] {position: relative;display: grid;justify-content: flex-start;}.mostysaneForm label.checkbox_val{font-size:12px;gap: 0;}input[type="date"]::-webkit-calendar-picker-indicator {position: absolute;top: 0;left: 0;right: 0;bottom: 0;width: auto;height: auto;color: transparent;background: transparent;}#mostlysane input[type="date"] {min-height: 40px;max-height:40px;background:#fff;border:1px solid #000 ;}#mostlysane input[type='date']:after {color: #3e3e3e;content: 'mm/dd/yyyy';position: absolute;left: 13px;top: 13px;}#mostlysane input[type="date"]:focus:after {content: '';}#mostlysane input[data-gtm-form-interact-field-id="0"]:after {content: '';} #mostlysane input[data-gtm-form-interact-field-id="1"]:after {content: '';}[data-gtm-form-interact-field-id]:after { content: '';}#mostlysane input[type="date"].full:after {content: '';}
}
</style>
<form id="mostlysane" class="mostysaneForm">
  <h3>{{ section.settings.heading }}</h3>

  <label for="firstName">First Name *</label>
  <input type="text" id="firstName" name="firstName" required>

  <label for="lastName">Last Name *</label>
  <input type="text" id="lastName" name="lastName" required>

  <label for="mobile">Mobile Number *</label>
  <input type="tel" id="mobile" name="mobile" maxlength="10" pattern="[0-9]{10}" required>

  <label>Email ID </label>
  <input type="email" id="email" name="email" >

  <label for="dob">Date Of Birth (Get Exclusive Perks!)</label>
  <input type="date" id="dob" name="dob" min="1965-01-01" max="2007-12-31" onkeydown="return false" oninput="checkDateForGoReward()">    
  <p id="dob-Error" class="error"></p>

  <label class="checkbox_val" for="sms_consent">
    <input type="checkbox" id="sms_consent" name="sms_consent" required>
    {{ section.settings.checkboxtext }}
  </label>

  <button type="submit" id="submitBtn" style="padding: 8px 16px;">Submit</button>

  <p id="message" style="margin-top: 10px; font-weight: bold;"></p>
</form>

<script>
  function checkDateForGoReward() {
    const input = document.getElementById("dob");
    const inputDate = new Date(input.value);
    const minDate = new Date("1965-01-01");
    const maxDate = new Date("2007-12-31");

    if (input.value) {
      input.classList.add("full");
    } else {
      input.classList.remove("full");
    }

    if (inputDate < minDate || inputDate > maxDate) {
      document.getElementById("dob-Error").textContent = "Please enter a valid date between 1965 and 2007.";
      return false;
    } else {
      document.getElementById("dob-Error").textContent = "";
      return true;
    }
  }

  document.getElementById("mostlysane").addEventListener("submit", async function(e) {
    e.preventDefault();

    const messageEl = document.getElementById("message");
    const submitButton = document.getElementById("submitBtn");

    // Prevent multiple clicks
    if (submitButton.disabled) return;

    // Disable button and show submitting text
    submitButton.disabled = true;
    const originalText = submitButton.textContent;
    submitButton.textContent = "Submitting...";

    messageEl.textContent = "";
    
    const firstName = document.getElementById("firstName").value.trim();
    const lastName = document.getElementById("lastName").value.trim();
    const mobile = document.getElementById("mobile").value.trim();
    const email = document.getElementById("email").value.trim();
    const dob = document.getElementById("dob").value;
    const sms_consent = document.getElementById("sms_consent").checked;

    // Basic Validation
    if (!firstName || !lastName || !mobile ) {
      messageEl.textContent = "Please fill all mandatory fields.";
      messageEl.style.color = "red";
      resetButton();
      return;
    }

       const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

// Email validation only if email field is not empty
if (email && !emailRegex.test(email)) {
  messageEl.textContent = "Please enter a valid email address.";
  messageEl.style.color = "red";
  resetButton();
  return;
}

    if (!/^\d{10}$/.test(mobile)) {
      messageEl.textContent = "Please enter a valid 10-digit mobile number.";
      messageEl.style.color = "red";
      resetButton();
      return;
    }

    if (!sms_consent) {
      messageEl.textContent = "Please agree to receive updates.";
      messageEl.style.color = "red";
      resetButton();
      return;
    }

    if (!checkDateForGoReward()) {
      resetButton();
      return;
    }

    // Prepare Data
    const payload = {
      first_name: firstName,
      last_name: lastName,
      mobile_number: mobile,
      {% comment %} email_id: email, {% endcomment %}
      dob: dob,
      sms_consent: sms_consent
    };

 

if (email.trim() !== "") {
  payload.email_id = email.trim();
}


    try {
      const response = await fetch("https://admin3157.gocolors.com/new_go_colors_india/public/api/mostysane-form", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await response.json();

      if (response.ok && data.success === true) {
        messageEl.textContent = data.message || "Form submitted successfully!";
        messageEl.style.color = "green";
        document.getElementById("mostlysane").reset();
      } else {
        messageEl.textContent = data.message || "Something went wrong. Please try again.";
        messageEl.style.color = "red";
      }
    } catch (error) {
      messageEl.textContent = "Error submitting form. Please check your connection.";
      messageEl.style.color = "red";
      console.error(error);
    }

    resetButton();

    // Hide message after some time
    setTimeout(() => {
      messageEl.style.display = "none";
    }, 5000);

    function resetButton() {
      submitButton.disabled = false;
      submitButton.textContent = originalText;
    }
  });
</script>

{%  schema %}
{
"name":"Mostly Sane Form",
"settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default":"Registration Form"
    },
    {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 200,
        "step": 10,
        "unit": "px",
        "label": "Padding Top",
        "default": 60
    },
    {
    "type": "range",
    "id": "padding_bottom",
    "min": 0,
    "max": 200,
    "step": 10,
    "unit": "px",
    "label": "Padding Bottom",
    "default": 60
    },
    {
    "type": "range",
    "id": "padding_top_mob",
    "min": 0,
    "max": 200,
    "step": 10,
    "unit": "px",
    "label": "Padding Top Mobile",
    "default": 60
    },
    {
    "type": "range",
    "id": "padding_bottom_mob",
    "min": 0,
    "max": 200,
    "step": 10,
    "unit": "px",
    "label": "Padding Bottom Mobile",
    "default": 60
    },
    {
    "type": "text",
    "id": "checkboxtext",
    "label": "Checkbox Label",
    "default": "Check Box stating I agree to send me an SMS/WhatsApp for the upcoming updates"
    },
],
"presets": [
    {
        "name":"Mostly Sane Form",
    }
]
}
{%  endschema %}