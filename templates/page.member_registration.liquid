{% comment %} <style>
 input::placeholder{
    color:#3e3e3e;
  }
  form#create_customer {
    padding-bottom: 70px;
     padding-top: 2rem;
}
.form {
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}
.member_registration h1 {
   font-weight:600;
  font-size:2.6rem;
  /* font-size: 24px;
  padding-bottom:20px; */
}
  input#register_btn {
    background: black;
    color: white;
}
form#create_customer input {
   font-weight: var(--font-body-weight);
  font-family: var(--font-body-family);
  font-size: 1.6rem;
  width: 320px;
  height: 45px;
  border: 1px solid #707070;
  padding: 1.5rem;
  border: 1px solid #3E3E3E;
  border-radius: 25px;
  /* color: #3e3e3e; */
  height: 4rem;
 
}
form#create_customer {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
.select_date {
  display: flex;
  justify-content: space-between;
  max-width: 360px;
  width:100%;  
  margin: 0 auto;
}
.select_date #year{
   font-weight: var(--font-body-weight);
  font-family: var(--font-body-family);
  font-size: 1.6rem;
  height: 45px;
  border: 1px solid #707070;
  padding: 8px;
  border: 1px solid #3E3E3E;
  border-radius: 25px;
  color: #3e3e3e;
  height: 4rem;
}
  #month{
     font-weight: var(--font-body-weight);
  font-family: var(--font-body-family);
  font-size: 1.6rem;
  height: 45px;
  border: 1px solid #707070;
  padding: 8px;
  border: 1px solid #3E3E3E;
  border-radius: 25px;
  color: #3e3e3e;
  height: 4rem;
  }
  #day{
     font-weight: var(--font-body-weight);
  font-family: var(--font-body-family);
  font-size: 1.6rem;
  height: 45px;
  border: 1px solid #707070;
  padding: 8px;
  border: 1px solid #3E3E3E;
  border-radius: 25px;
  color: #3e3e3e;
  height: 4rem;
  }
  
}
  
div#radio_btn {
  font-weight: var(--font-body-weight);
  font-family: var(--font-body-family);
  font-size: 1.6rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 360px;
  width:100%;
  gap: 5%;
  margin: 0 0;
  
}
  #radio_btn {
    width: 320px;
    display: flex;
    padding-right: 10rem;
    gap: 2rem;
    align-items: center;
    justify-content: space-between;
}
/* form#create_customer .registration_data div#radio_btn input {
  height: fit-content;
  width: 5%; margin: 0 0;
} */
/* .select_date > div:first-child {
  flex: 30%;
}
.select_date > div {
  flex: 45%;
}
.select_date > div:last-child {
  flex: 25%;
} */
.select_date .pretty-select {
  height: 40px;
  padding: 6px 0;
  width: 100%;
  border-radius: 10px;
}
span.text {
  width: 100%;
  display: block !important;
  padding: 1px 15px !important;
  text-align: center;
}
div#parent_check {
  margin: 10px auto;
  display: flex;
  align-items:baseline;
  gap: 2%;
  max-width: 360px;
  width:100%;
}
form#create_customer input#checkbox {
  height: 100%;
  width: fit-content;
  float: left;
  accent-color: #000;margin: 0;
}
.checkbox_label {
  font-size: 14px;
  text-transform: inherit;
  text-align: left;
  float: left;
  width: 300px;
}

p.heading_date {
  width: 100%;
  max-width: 360px;
  text-align: left;
  margin: 0 auto;
}
.select_date .pretty-select svg {
  right: 0px !important;
}
span.text {
  padding: 0 10px !important;
  text-align: left;
}
.pretty-select.id-month {
  width: 120px;
}
p.messsage_show {
  max-width: 360px;
  text-align: left;
  width: 100%;
  margin: 0 auto;
  color: red;
  font-size: 12px;
}
.otp_btns_div {
  display: flex;
  max-width: 320px;
  width: 100%;
  gap: 20px;
  margin: 0 auto;
}

div#thanks {
  padding: 0 10px 55px;
  max-width: 360px;
  width: 100%;
  margin: 0 auto;
  text-align: center;
}
div#thanks img {
  padding-bottom: 35px;
  width: 100%;
}
.thank_div h2 {
  padding-bottom: 15px !important;
}
form#create_customer .otp_btns_div input{
  background-color: transparent;
  color: #000;
  font-weight: 400;
  font-size: 14px !important;
  width: 100%;
  padding: 0;
}
form#create_customer .otp_btns_div input.checkOtp {
  background-color: #000;
  color: #fff;
}
span {
  font-size: 16px;
  font-weight: 600;
}
.thank_div p {
  padding: 23px 0;
}
span.thanks_btn {
  display: none;
  /* margin: 30px auto; */
}
.alert-success span {
  font-size: 12px;
}
.alert-success {
  display: flex;
  /* align-items: center; */
  justify-content: center;
  background-color: green;
  color: #fff;
  padding:  5px 10px 5px 30px;
  text-align: center;
  position: relative;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  width: 100%;
  margin-bottom: 2rem;
}
span.close {
  position: absolute;
  left: 10px;
  top: 8px;
  color: #000;
  background-color: #fff;
  border-radius: 50px;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  cursor: pointer;
  font-weight: 600;
  padding-bottom: 2px;
}
.registration_data{
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin: 40px auto 20px;
}
input#register_btn {
    padding: 0 !important;
  
form#create_customer input.otp {
    max-width: 360px;
}
  span.value {
    font-weight: 400;
}
  .otp_btns_div input {
    height: 45px;
}
@media screen and (min-width:1200px){
  alert-success{
   padding: 5px 10px 5px 60px;
    align-items: center;
  }
.alert-success span {
  font-size: 15px;
}
span.close{
  left: 5px;
}
.member_registration {
  margin: 3rem auto;
}
form#create_customer  input {
  width: 360px;
  height: 45px;
}
.select_date .pretty-select {
 width:100px;
}
form#create_customer input.otp {
    max-width: 360px;
}
}
</style>


<div class="member_registration">
  {% form 'create_customer', id: 'create_customer' ,class:'form' %}
    <h1>MEMBER REGISTRATION</h1>
    <div class="registration_data">
    {{ form.errors | default_errors }}
        <input aria-label="{{ 'customer.register.first_name' | t }}" placeholder="{{ 'customer.register.first_name' | t }}*"
        type="text" value="" name="customer[first_name]" id="first_name" class="large {% if form.errors contains "first_name" %}error{% endif %}"
        size="30"  maxlength="20" onkeydown="return /[a-z]/i.test(event.key)" />   
       
        <input aria-label="{{ 'customer.register.last_name' | t }}" placeholder="{{ 'customer.register.last_name' | t }}*"
        type="text" value="" name="customer[last_name]" id="last_name"class="large {% if form.errors contains "last_name" %}error{% endif %}"
        size="30" maxlength="20" onkeydown="return /[a-z]/i.test(event.key)" />
       
        <input autocomplete="off" aria-label="{{ 'customer.register.phone' | t }}" placeholder="Phone"  type="tel" value="{{ customer.register.phone }}"
        name="customer[phone]" disabled id="phone" class="large phone" size="10" maxlength="10" minlength="10"onkeypress="return /[0-9]/i.test(event.key)">
       
        <input autocomplete="off" aria-label="{{ 'customer.register.email' | t }}" placeholder="{{ 'customer.register.email' | t }}" type="email"
        value="" name="customer[email]" id="email"class="large {% if form.errors contains "email" %}error{% endif %}" />
        
       <input autocomplete="off" aria-label="{{ 'customer.register.password' | t }}" placeholder="{{ 'customer.register.password' | t }}"type="password"
        value="" name="customer[password]" id="password" class="large password {% if form.errors contains "password" %}error{% endif %}" />
      
      <p class="heading_date">Date Of Birth</p>
    
       <div class="select_date">
          <div>
            <select id="year" name="yyyy" ></select>
            <p id="year_err"></p>
          </div>
          <div>
            <select id="month" name="mmm" ></select>
            <p id="month_err"></p>
          </div>
          <div>
            <select id="day" name="dd"></select>
            <p id="day_err"></p>
          </div>
        </div>
    
        <div id="radio_btn">
          <input type="radio" name="customer[gender]" id="female" value="F">Female
          <input type="radio"name="customer[gender]" id="male" value="M">Male
        </div>
    
        <div class="input-row" data-cc-animate data-cc-animate-delay="0.65s" id="parent_check">
          <input type="checkbox" class="termscheck" id="checkbox" name="scales" checked>
          <label for="checkbox" class="checkbox_label">I agree to get promotional updates from Go Colors through Whatsapp, E-mail & SMS</label>
        </div>
       <input type="button"  value="Send OTP" data-cc-animate class="new_user_reg"  data-cc-animate-delay="0.8s" id="register_btn"/>
    </div>
  
     <div class="otp_id form" style="display:none;">
       <div class="alert-success" >
        <span>An OTP has been sent to your registered Mobile</span>
        <span class="close" data-dismiss="alert">x</span>
      </div>
        <h2>ENTER OTP</h2>
         <input type="text" value="" name="otp" class="otp {% if form.errors contains "otp" %}error{% endif %}" onkeypress="return onlyNumberKey(event)"
           placeholder="Please enter 6 digit OTP" maxlength="6" minlength="6">
        <p class="otp_error" style="color:red;"></p>
         <div class="otp_btns_div">
           <input type="button" data-cc-animate data-cc-animate-delay="0.8s" value="Verify" class="checkOtp acc_btn" >
           <input type="button" data-cc-animate data-cc-animate-delay="0.8s" value="Resend OTP" class="resendOTP acc_btn" >
         </div>
     </div>
    <input type="hidden" value="" name="customer[note][DOB]" id="hidden_dob"/>
  
    {% endform %}
     <div id="thanks" class="thank_div"  style="display:none;">
       <img src="https://cdn.shopify.com/s/files/1/0598/8158/6848/files/Thank_you_go_rewards-01.svg?v=1683025899">
       <h2>YAY!</h2>
       <span style="font-size: 16px; font-weight: 600;">YOUR ACCOUNT IS CREATED.</span>
       <p>Explore the latest range of bottomwear in array of colors!</p>
       <span class="thanks_btn">
         <a href="{{ shop.url }}"class="login_system">SHOP NOW</a> 
         <a href="{{ shop.url }}/pages/my-account" class="login_system">MY ACCOUNT</a>
       </span>
      </div>
    
</div>

<script>

$(document).ready(function() {
    //var account_page = "{{ shop.url }}/pages/my-account";
    var Days = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    // Populate day dropdown
    var dayOption = '<option value="day">day</option>';
    var selectedDay = "day";
    for (var i = 1; i <= Days[0]; i++) {
        var dayValue = (i <= 9) ? "0" + i : i;
        dayOption += '<option value="' + dayValue + '">' + dayValue + '</option>';
    }
    $('#day').append(dayOption);
    $('#day').val(selectedDay);
    // Populate month dropdown with short month names
    var monthName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    var shortMonthName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    var monthOption = '<option value="month">month</option>';
    var selectedMon = "month";
    for (var i = 0; i < 12; i++) {
        monthOption += '<option value="' + shortMonthName[i] + '">' + monthName[i] + '</option>';
    }
    $('#month').append(monthOption);
    $('#month').val(selectedMon);
    // Populate year dropdown
    var d = new Date();
    var yearOption = '<option value="year">year</option>';
    var selectedYear = "year";
    for (var i = 1930; i <= d.getFullYear(); i++) {
        yearOption += '<option value="' + i + '">' + i + '</option>';
    }
    $('#year').append(yearOption);
    $('#year').val(selectedYear);

    // Function to check if a year is a leap year
    function isLeapYear(year) {
        year = parseInt(year);
        if (year % 4 !== 0) {
            return false;
        } else if (year % 400 === 0) {
            return true;
        } else if (year % 100 === 0) {
            return false;
        } else {
            return true;
        }
    }

    // Function to update days based on selected month and year
    function updateDays(month, year) {
        var dayDropdown = $('#day');
        var selectedDay = dayDropdown.val();
        dayDropdown.empty();
        
        var monthIndex = shortMonthName.indexOf(month);
        var daysInMonth = Days[monthIndex];
        if (monthIndex === 1 && isLeapYear(year)) {
            daysInMonth = 29;
        }

        var option = '<option value="day">day</option>';
        for (var i = 1; i <= daysInMonth; i++) {
            var dayValue = (i <= 9) ? "0" + i : i;
            option += '<option value="' + dayValue + '">' + dayValue + '</option>';
        }
        dayDropdown.append(option);
        if (selectedDay > daysInMonth) {
            selectedDay = 1;
        }
        dayDropdown.val(selectedDay);
    }

    // Event listener for year change
    $('#year').change(function() {
        var selectedYear = $(this).val();
        var selectedMonth = $('#month').val();
        if (selectedMonth !== 'month') {
            updateDays(selectedMonth, selectedYear);
        }
    });

    // Event listener for month change
    $('#month').change(function() {
        var selectedMonth = $(this).val();
        var selectedYear = $('#year').val();
        if (selectedYear !== 'year') {
            updateDays(selectedMonth, selectedYear);
        }
    });
    var strored_phone = localStorage.getItem('mobile_Number');
   // var register_mob = $('#phone').val();
     var register_mob = $('#phone').val(strored_phone);
     var mob_no = $('#phone').val();
     // var missing_data = localStorage.getItem('missing_data');
     // var strored_first_name = localStorage.getItem('first_name');
     // var strored_last_name = localStorage.getItem('last_name');
     // var strored_email_id = localStorage.getItem('email_id');
     // var strored_gender = localStorage.getItem('gender');
     // var strored_date = localStorage.getItem('dateOfBirth');
     // if(missing_data = true ){
     //   console.log('already customer update data');
     //   if(strored_first_name != ''){
     //     var first_name = $('#first_name').val(strored_first_name);
     //     console.log(first_name);
     //     $(first_name).prop('disabled');
     //     $(first_name).prop('readonly');
     //   }
     //   if(strored_last_name != ''){
     //     var last_name = $('#last_name').val(strored_email_id);
     //     console.log(last_name);
     //     $(last_name).prop('disabled');
     //     $(last_name).prop('readonly');
     //   }
     //   if(strored_email_id != ''){
     //     var email = $('#email').val(strored_email_id);
     //     console.log(email);
     //     $(email).prop('disabled');
     //     $(email).prop('readonly');
     //   }
      
     //   if(strored_date = true ){
     //     console.log(strored_date + ' dateOfBirth is blank');
     //   }
     //   else{
     //      alert(strored_date + "sakshi");
     //        var dateOfBirth = strored_date.split(' ');
     //        var day = dateOfBirth[0];
     //        var month = dateOfBirth[1];
     //        var year = dateOfBirth[2];
     //        var final_dob = day + " " + month + " " + year;
     //        $("#year > option").each(function() {
     //           if(this.value == year){
     //             $(this).attr('selected',true).change();
     //           }
     //           else{
     //               $(this).attr('disabled', true);
     //           }
     //        });
     //        $("#month > option").each(function() {
     //           if(this.value == month){
     //             $(this).attr('selected',true).change();
     //           }
     //           else{
     //               $(this).attr('disabled', true);
     //           }
     //        });
     //        $("#day > option").each(function() {
     //           if(this.value == day){
     //             $(this).attr('selected',true).change();
     //           }
     //           else{
     //               $(this).attr('disabled', true);
     //           }
     //        });
         
     //   }
       
     // }
    $('#register_btn').click(function(){
    var count = 0;
    var first_name = $('#first_name').val();
    var last_name = $('#last_name').val();
    var email = $('#email').val();
    var pass = $('#password').val();
    var year = $('#year').val();
    var month = $('#month').val();
    var day = $('#day').val();
    
    //var mob_no = $('#phone').val(strored_phone);
    var gender = "";
    if ($("input[name='customer[gender]']:checked").val()) {
      gender = $("input[name='customer[gender]']:checked").val();
    }
    var dob = new Date(year, month, day);
      dob.setMonth(month - 1);
     var DOB = dob.toLocaleString('en-US', {month: 'short'});
     var final_dob = day + " " + month + " " + year;
     $(".messsage_show").remove();
     // validation 
     // first name
      if (first_name.length < 3) {
        $('#first_name').after('<p class="messsage_show">Please enter the first name</p>');
      }
      else {
        count = count + 1;
        console.log('first name  success');
      }
     // last nane
      if (last_name.length < 3) {
        $('#last_name').after('<p class="messsage_show">Please enter the last name</p>');
      } 
      else {
        count = count + 1;
        console.log('last name success')
      }
     // phone
      //  if (mob_no.length < 10) {
      //   $('#phone').after('<p class="messsage_show">Please enter 10 digit mobile number</p>');
      //  }
      //  else if (! regmob.test(mob_no)) {
      //   $('#phone').after('<p class="messsage_show">Please enter valid mobile number</p>');
      //   } 
      //  else {
      //   count = count + 1;
      //   console.log('mobile no success');
      // }

      // email
      if (email.length < 1) {
        $('#email').after('<p class="messsage_show">Please enter email id</p>')
      }
      else if (testEmail(email) == false) {
        $('#email').after('<p class="messsage_show">Enter a valid email</p>');
      }
      else {
        count = count + 1;
        console.log('email success');
      }
      function testEmail(email) {
        var pattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
        if (pattern.test(email)) {
          return true;
        } else {
          return false;
        }
      }
      //password
      if (pass.length == 0) {
        $('#password').after('<p class="messsage_show">Please enter password</p>');
      } 
      else if (pass.length < 8) {
        $('#password').after('<p class="messsage_show">Password must has at least 8 characters</p>');
      }
      else {
        count = count + 1;
        console.log('password success');
      }

     // DOB

      if (year == "year") {
        $('.select_date').after('<p class="messsage_show">Please select year</p>')
      } 
      else if ( month == "month" ){
         $('.select_date').after('<p class="messsage_show">Please select month</p>')
     }
      else if (  day == "day" ){
            $('.select_date').after('<p class="messsage_show">Please select day</p>')
      }
      else {
        count = count + 1;
      }

     // gender

      if (!$("input[name='customer[gender]']:checked").val()) {
        $('#radio_btn').after('<p class="messsage_show">Please select a gender</p>');
       
      }
      else {
         count = count + 1;
        console.log('One of the radio buttons is checked!');
      }
      if (!$("input[type='checkbox']:checked").val()) {
        $('#parent_check').after('<p class="messsage_show">please select checkbox</p>');
       
      }
      else {
        count = count + 1;
      }
      if (count == 7 ) {
        console.log('success form');
         $('#hidden_dob').val(final_dob);
        console.log($('#hidden_dob').val());
        var customer_data = {
          "first_name": first_name,
          "last_name": last_name,
          "email": email,
          "password": pass,
          "mobile_no": mob_no,
          "DateOfBirth": final_dob,
          "gender": gender
       }
        console.log(customer_data);
        
      } 
      else {
        console.log('error form');
       
        return false;
      }
      if (count == 7) {
        //  if(missing_data = true ){
        //  }
        // else{
          $.ajax({
            url: "https://admin3157.gocolors.com/new_go_colors_india/public/api/customer-create",
            type: "POST",
            dataType: "json",
            crossDomain: true,
            format: "json",
            data: customer_data,
            success: function(resp) {
            if (resp.success == true) {
              console.log(resp);
              $.ajax({
                url: "https://admin3157.gocolors.com/new_go_colors_india/public/api/send-otp",
                type: "POST",
                dataType: "json",
                crossDomain: true,
                format: "json",
                data: customer_data,
                success: function(resp) {
                  if (resp.success == true) {
                      $('.registration_data').hide();
                      $('.member_registration h1').hide();
                      $('.otp_id').show();
                       $('.close').click(function(){
                        $('.alert-success').hide();
                      });
                      $('.checkOtp').click(function(){
                        VerifyOtp();
                      });
                      $('.resendOTP').click(function(){
                         ResendOtp();
                      });  
                  }
                  else{
                     $('.otp_error').text("Something went wrong");
                        event.preventDefault();
                      return false;
                   }
                }
              });
            } 
            else {
              $('#register_btn').before('<p class="messsage_show">' + resp.message + '</p>');
            }
        }
      });
         // } 
        function VerifyOtp(){
               var otp = $('.otp').val();
               customer_data['otp']= otp;
               console.log(customer_data);
               $('.otp_error').hide();
                $.ajax({
                  url: "https://admin3157.gocolors.com/new_go_colors_india/public/api/verify-otp",
                  type: 'POST',
                  dataType: 'json',
                  data: customer_data,
                  success: function(resp) {
                    if (resp.success == true) {
                      $('.registration_data').hide();
                      $('.otp_id').hide();
                      $('#create_customer').submit();
                      $('#create_customer').hide();
                      $("#thanks").show();
                      $('.otp_error').hide();
                      var otpStatus = $.trim($('.otp_error').text());
                      Moengage.track_event("otpVerificationAttempted", {
                          "otpStatus": 'valid OTP',
                        });
                      setTimeout(function () {
                          window.location.href = account_page;
                      },1000);
                    }
                    else {
                     $('.otp_id').show();
                     $('.close').click(function(){
                      $('.alert-success').hide();
                     });
                      $('.otp_error').text("OTP does not match");
                      Moengage.track_event("otpVerificationAttempted", {
                        "otpVerificationAttempted": 'otpVerificationAttempted' ,
                        "otpVerificationAttempted.otpStatus": 'OTP does not match',
                      });
                      event.preventDefault();
                      return false;
                  } 
                  }
               });
            }
        function ResendOtp(){
          $.ajax({
            url: "https://admin3157.gocolors.com/new_go_colors_india/public/api/send-otp",
            type: 'POST',
            dataType: 'json',
            data: {
              "mobile_no": mob_no,
              "first_name": first_name
            },
            success: function(resp) {
              if (resp.success == true) {
                $('.registration_data').hide();
                $('.memeber_login h1').hide();
                $('.otp_id').show();
                $('.close').click(function(){
                      $('.alert-success').hide();
                    });
              }
              else {
                $('.otp_error').text("Something went wrong");
                event.preventDefault();
                return false;
              }
            }
          });
        }
      }
   });
});


</script> {% endcomment %}
